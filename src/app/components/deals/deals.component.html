<ngx-spinner bdColor="rgba(0, 0, 0, 0.8)" size="medium" color="#fff" type="square-jelly-box" [fullScreen]="true">
  <p style="font-size: 20px; color: white">Loading...</p>
</ngx-spinner>

<div class="container-scroller">
  <div class="container-scroller">
    <nav class="navbar default-layout-navbar col-lg-12 col-12 p-0 fixed-top d-flex flex-row">
      <div class="navbar-menu-wrapper d-flex align-items-center flex-grow-1" style="background-color: #1269db!important;color: #fff;">
        <a href="" class="logo-link">
          <h3 class="logo-capsource" style=" width: 237px;height: 62px;align-items: center;  display: flex;justify-content: center;">
          <span class="capSource">CapSource Manager</span></h3></a>
          <ul class="navbar-nav navbar-nav-right ml-auto">
             <i class="fas fa-sync sync c-white"  (click)="Sync()"></i>
             <span *ngIf="this.General.LoadSync?.syncEndDate == null" >Synchronizing  <div class="spinner-border mx-2" role="status"></div></span>
             <span *ngIf="this.General.LoadSync?.syncEndDate?.length >0">Last sync date is : {{this.General.LoadSync?.syncEndDate| date:'short'}}</span>
            <i class="fas fa-users-cog navbar-icons"   [routerLink]="['/loan']"  title="InTake Admin" ></i>
            <i class="fab fa-ideal navbar-icons"  title="Assign Mail To MicroDeal"[routerLink]="['/mailToMicrodeal']"></i>
            <i class="fas fa-envelope-open-text navbar-icons"   [routerLink]="['/inbox']" ></i>
            <i class="fas fa-upload navbar-icons"  title="Upload Global Data Source" [routerLink]="['/UploadGlobalDataSource']"></i>
            <i class="fas fa-list-ul navbar-icons" title="Lenders" [routerLink]="['/lenders']"></i>
          </ul>
         <button class="navbar-togglernavbar-toggler-right d-lg-none align-self-center" type="button" data-toggle="offcanvas"> <span class="icon-menu"></span></button>
      </div>
    </nav>
  </div>
</div>

<!-- <div class="container-scroller">
  <nav class="navbar default-layout-navbar col-lg-12 col-12 p-0 fixed-top d-flex flex-row ">
    <div class="navbar-brand-wrapper d-flex align-items-center" style="overflow-x: inherit;">
      <a class="navbar-brand brand-logo" href="index.html">
        <div class="logo-holder logo-6">
          <a href="">
            <h3><span>CapSource Manager</span></h3>
          </a>
        </div>
      </a>
    </div>
    <div class="navbar-menu-wrapper d-flex align-items-center flex-grow-1">
      <h5 class="mb-0 font-weight-medium d-none d-lg-flex">Welcome CapSource Manager dashboard!</h5>
      <ul class="navbar-nav navbar-nav-right ml-auto">
        <i class="fas fa-sync sync" (click)="Sync()"></i>
        <span *ngIf="this.General.LoadSync?.syncEndDate == null" >Synchronizing  <div class="spinner-border mx-2" role="status"></div></span>
        <span *ngIf="this.General.LoadSync?.syncEndDate?.length >0">Last sync date is : {{this.General.LoadSync?.syncEndDate| date:'short'}}</span>
        <i class="fas fa-users-cog inbox"  [routerLink]="['/loan']"  title="InTake Admin" ></i>
        <i class="fab fa-ideal inbox" [routerLink]="['/mailToMicrodeal']" title="Assign Mail"></i>
        <i class="fas fa-envelope-open-text inbox" [routerLink]="['/inbox']" title="Inbox"></i>
      </ul>
      <button class="navbar-toggler navbar-toggler-right d-lg-none align-self-center" type="button" data-toggle="offcanvas">
        <span class="icon-menu"></span>
      </button>
    </div>
  </nav>
</div> -->
<!-- <div style="margin-top: 72px; border-radius: 18px;">
<div class="timeline">
  <div *ngFor="let Timeline of General.TimeLine" class="timeline-event">
    <div class="timeline-point-track-container">
      <div class="timeline-point" [ngClass]="Timeline?.highlighted == true ? 'Heighlight' :'' "></div>
    </div>
      <span class="timeline-date"  [ngClass]="Timeline?.highlighted == true ? 'timeline-date-heighlight' :'' ">
        {{Timeline.fromDate}} :
      <div class="col-lg-12 " *ngIf="Timeline.actions.length >0" style="padding-left: 0px; margin: 15px 0px;">
            <table class="table table-bordered" >
              <tbody>
                <tr *ngFor="let action of Timeline.actions">
                  <td *ngIf="action.actionName == 'MailRead'" class="mr-2"
                  style=" padding: 2px 4px; border-radius: 14px;">
                    <i class="fas fa-envelope-square" title="MailRead"></i>
                </td>
                <td *ngIf="action.actionName == 'Downlaod File'" class="mr-2"
                    style="padding: 2px 4px; border-radius: 14px;">
                   <i class="fas fa-download" title="Downlaod File"></i>
                </td>
                <td *ngIf="action.actionName == 'Landing Page Load'" class="mr-2"
                  style="padding: 2px 4px; border-radius: 14px;">
                    <i class="fas fa-envelope-square" title="Landing Page Load"></i>
                </td>
                <td *ngIf="action.actionName == 'Preview File'" class="mr-2"
                  style="padding: 2px 4px; border-radius: 14px;">
                  <i class="fas fa-eye" title="Preview File"></i>
                </td>
                  <td >{{action.name}}</td>
                  <td> {{action.actionName}} </td>
                  <td> {{action.person}}</td>
                  <td> {{action.item}}</td>
                  <td> {{action.actionDate}}</td>
                </tr>
              </tbody>
            </table>

      </div>
    </span>
  </div>
</div>


</div> -->

<!-- <div  style="margin-top: 90px;">
  <div class="container-fluid">
    <div class="float-left ">
      <i class="fas fa-arrow-left" (click)="scrollLeft()"></i>
  </div>

  <div class="scrollmenu" #widgetsContent>

    <div class="event-list"  *ngFor="let Timeline of General.TimeLine"
    style="background-color: #2c3e50; border-radius: 15px;">
      <div class="px-4">
          <div class="event-date bg-soft-primary text-primary" style="
           text-align: center;
          padding: 10px;
          width: fit-content;
          border-bottom-right-radius:10px">{{Timeline.fromDate}}</div>

          <h5 class="font-size-16">Event One</h5>
      </div>
        <ng-container *ngFor="let action of Timeline.actions">
            <p class="text-muted">{{action.name}}</p>
          </ng-container>
    </div>
    </div>
    <div class="pull-right ">
      <i class="fas fa-arrow-right" (click)="scrollRight()"></i>
      </div>
  </div>


    </div> -->


          <div class="col-lg-12">
                  <div class="card-body">
                      <h4 class="card-title mb-5">Timeline</h4>
                      <div class="hori-timeline" dir="ltr">
                          <ul class="events" style="overflow: auto; padding: 1px;">
                            <li>
                              <div class="prev-container"> <i class="fas fa-arrow-left prev" (click)="scrollLeft()" title="Previous"></i> </div>
                            </li>
                            <div class="mb-3">
                            <i class="fas fa-angle-double-left fast-go" (click)="GotoTheStart()"></i>
                            <i class="fas fa-angle-double-right fast-go float-right" (click)="GotoTheEnd()"></i>
                            </div>
                            <div class="scrollmenu" #widgetsContent  >
                              <div *ngFor="let Timeline of General.TimeLine">
                                <li class="event-list" *ngIf="Timeline.actions.length > 0"  >
                                    <div class="mx-5">
                                      <div class="event-date" >{{Timeline.fromDate}}</div>
                                            <table class="table table-bordered action-table" >
                                              <tbody>
                                                <tr *ngFor="let action of getActionss(Timeline)">
                                                  <td *ngIf="action.actionName == 'MailRead'" class="mr-2" style=" padding: 2px 4px; border-radius: 14px;">
                                                    <i class="fas fa-envelope-open-text" title="MailRead" style="color:#eb3b5a;font-size: 19px;"></i>
                                                  </td>
                                                  <td *ngIf="action.actionName == 'Received Email'" class="mr-2" style=" padding: 2px 4px; border-radius: 14px;">
                                                    <i class="fas fa-envelope-square" title="Received Email" style="color:#00a8ff;font-size: 19px;"></i>
                                                  </td>
                                                  <td *ngIf="action.actionName == 'Downlaod File'" class="mr-2" style="padding: 2px 4px; border-radius: 14px; ">
                                                    <i class="fas fa-download" style="color: #6ab04c;;font-size: 19px;" title="Downlaod File"></i>
                                                  </td>
                                                  <td *ngIf="action.actionName == 'Landing Page Load'" class="mr-2" style="padding: 2px 4px; border-radius: 14px;">
                                                    <i class="fab fa-chrome" title="Landing Page Load" style="color: #00d2d3;font-size: 19px;"></i>
                                                  </td>
                                                  <td *ngIf="action.actionName == 'Preview File'" class="mr-2" style="padding: 2px 4px; border-radius: 14px;">
                                                    <i class="fas fa-eye"  style="color: #ffa801; ;font-size: 19px;"title="Preview File"></i>
                                                  </td>
                                                  <td *ngIf="action.name.length >0 " style="font-weight: 800;" >{{action.name}}</td>
                                                  <!-- <td *ngIf="action.actionName.length >0 "> {{action.actionName}} </td> -->
                                                  <td *ngIf="action.person?.length >0 " > {{action.person}} </td>
                                                  <td *ngIf="action.item.length >0 " style="font-weight: bold;"> {{action.item}}</td>
                                                  <td *ngIf="action.actionDate.length >0 "> {{action.actionDate}}</td>
                                                </tr>
                                              </tbody>
                                            </table>
                                        </div>
                                </li>
                              </div>
                            </div>

                            <li>
                              <div class="perv-container">
                                <i class="fas fa-arrow-right next-prev" (click)="scrollRight()" title="Next"></i>
                              </div>
                          </li>
                          </ul>
                      </div>
                  </div>
              </div>


<div class="content-wrapper" >
  <div class="row quick-action-toolbar">
    <div class="col-md-12 grid-margin">
      <div class="card">
        <div class="card-header d-block d-md-flex" style="background-image: linear-gradient(to left, #1269db, #1269db);">
          <h5 class="mb-0">Summary of Actions Macro Deals</h5>
        </div>
        <table class="table table-bordered action-table " *ngIf="General.MacroDealStats" >
          <thead>
            <tr>
              <th style="font-weight: bold; color: black; width: 10px;">Name</th>
              <th class="state-head" style="font-weight: bold;">Landing Load</th>
              <th class="state-head" style="font-weight: bold;">Email Read</th>
              <th class="state-head" style="font-weight: bold;">Download File</th>
              <th class="state-head" style="font-weight: bold;">Preview File</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let State of General.MacroDealStats">
              <td [routerLink]="['/main',State.macroDealId]" style="cursor: pointer;" > {{State.macroDealTitle}} </td>
              <td class="state-body"> {{State.landingLoad}}</td>
              <td class="state-body"> {{State.emailRead}}</td>
              <td class="state-body"> {{State.downloadFile}}</td>
              <td class="state-body"> {{State.previewFile}}</td>
            </tr>
          </tbody>
        </table>

      </div>
      <div class="card" *ngIf="General.GetMicroDealStats?.length>0">
        <div class="card-header d-block d-md-flex" style="background-image: linear-gradient(to left, #1269db, #1269db);">
          <h5 class="mb-0">Summary of Actions Micro Deals</h5>
        </div>
        <table class="table table-bordered" *ngIf="General.GetMicroDealStats" >
          <thead>
            <tr>
              <th style="font-weight: bold; color: black;">Organization Name</th>
              <th style="font-weight: bold; color: black;">Macro Deal Name </th>
              <th class="state-head">Landing Load</th>
              <th class="state-head">Email Read</th>
              <th class="state-head">Download File</th>
              <th class="state-head">Preview File</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let State of General.GetMicroDealStats ">
              <td >{{getOrganizationName(State.organizationId)}} </td>
              <td [routerLink]="['/main',State.macroDealId]" style="cursor: pointer;">{{State.macroDealTitle}} </td>
              <td class="state-body"> {{State.landingLoad}}</td>
              <td class="state-body"> {{State.emailRead}}</td>
              <td class="state-body"> {{State.downloadFile}}</td>
              <td class="state-body"> {{State.previewFile}}</td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>
</div>


<div class="content-wrapper">
  <div class="row quick-action-toolbar">
    <div class="col-md-12 grid-margin">
      <div class="card">
        <div class="card-header d-block d-md-flex" style="background-image: linear-gradient(to left, #1269db, #1269db);">
          <h5 class="mb-0">Active Micro Deals</h5>
        </div>
        <div class="d-md-flex row m-0 quick-action-btns mb-5"  role="group" aria-label="Quick action buttons">
          <div class="col-sm-6 col-md-4 p-2 active-micro"
           [routerLink]="['/main', MicroDeal.group.scenario.dealId , MicroDeal.group.scenario.id, MicroDeal.group.id , MicroDeal.id]"
           *ngFor="let MicroDeal of General.ActiveMicroDeals; let i = index">
            <button type="button" class="px-0 pipe" >
            <span style="font-size: 18px;">  {{GetOrganization(MicroDeal.organizationId)}} </span>
             <br> <br> <b class="ml-1">{{GetMacro(MicroDeal.group.scenario.dealId)}}</b>
            </button>
          </div>
        </div>
        <div class="card-header d-block d-md-flex"
        style="background-image: linear-gradient(to left, #1269db, #1269db);">
          <h5 class="mb-0">Active Macro Deals</h5>
        </div>
        <div class="d-md-flex row m-0 quick-action-btns mb-5" role="group" aria-label="Quick action buttons">
          <div class="col-sm-6 col-md-4 p-2 active-micro "
            *ngFor="let MacroDeal of General.ActiveMacroDeals; let i = index">
            <button type="button" class="px-0 pipe" [routerLink]="['/main',MacroDeal.pipedriveId]">
              {{MacroDeal.title}}
            </button> <i class="fas fa-eye-slash ml-2" style="margin-top: 17px; cursor: pointer;" (click)="HideActiveMacroDeal(MacroDeal.pipedriveId)"></i>
          </div>
        </div>
        <div class="card-header d-block d-md-flex"
        style="background-image: linear-gradient(to left, #1269db, #1269db);">
          <h5 class="mb-0">Pipelines</h5>
        </div>
        <div class="d-md-flex row m-0 quick-action-btns" role="group" aria-label="Quick action buttons">
          <div class="col-sm-6 col-md-3 p-2 text-center btn-wrapper"
            *ngFor="let pipeline of General.pipeline ;  let i = index">
            <button type="button" class="px-0 pipe" (click)="GetPipeLineStages(pipeline ,i)"
              [ngClass]="{'highlight': selectedIndex === i}">
              <i class="fas fa-stream mr-2"></i> {{pipeline}} </button>
          </div>
        </div>

        <!-- <div class="d-md-flex row m-0 quick-action-btns" role="group" aria-label="Quick action buttons">

          <div class="col-sm-6 col-md-3 p-2 text-center btn-wrapper"
           *ngFor="let pipe of pipeLines ;  let i = index">

            <button type="button" class="px-0 pipe" (click)="pipeBtnHandler(i)"
              [ngClass]="{'highlight': selectedIndex === i}">

              <i class="fas fa-stream mr-2"></i> {{pipe.name}}
            </button>
          </div>
        </div> -->
      </div>
    </div>
  </div>

  <div class="row" *ngIf="activePipeIndex!=-1">
    <div class="col-md-12 grid-margin">
      <div class="card">
        <div class="card-body">
          <div class="row">
            <div class="col-md-12">
              <div class="d-sm-flex align-items-baseline report-summary-header">
                <h3 class="font-weight-semibold" style="font-size: 22px;letter-spacing: 1px;"><b>Stages</b></h3>
                <span class="ml-auto" style="font-size: 22px">
                   <b>Updated Report</b></span><button class="btn btn-icons border-0 p-2"><i class="icon-refresh"></i></button>
              </div>
            </div>
          </div>
          <div class="row report-inner-cards-wrapper report-inner-card">
            <div class="col-md-6 col-xl report-inner-card" style="display:block;" *ngFor="let stages of General.stages">
              <div class="inner-card-text">
                <span class="report-title mb-3">{{stages.StageTitle}}</span>
              </div>
              <div *ngFor="let deal of GetDealOfStage(stages)" class="deals">
                <span class="deal-details active-deal" [routerLink]="['/main',deal.pipedriveId]">
                  {{deal.title}} </span>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
