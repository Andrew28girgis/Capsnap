<ngx-spinner bdColor="rgba(0, 0, 0, 0.9)" size="medium" color="#fff" type="square-jelly-box" [fullScreen]="true">
 <p style="font-size: 20px; color: white">Loading...</p> </ngx-spinner>

<!-- Start Navbar -->
<div class="container-scroller">
  <nav class="navbar default-layout-navbar col-lg-12 col-12 p-0 fixed-top d-flex flex-row">
    <div class="navbar-menu-wrapper d-flex align-items-center flex-grow-1" style="background-color: #1269db!important;color: #fff;">
      <a href="" class="logo-link">
        <h3 class="logo-capsource" style=" width: 237px;height: 62px;align-items: center;  display: flex;justify-content: center;">
        <span class="capSource">CapSource Manager</span></h3></a>
        <ul class="navbar-nav navbar-nav-right ml-auto">
           <i class="fas fa-sync sync c-white" (click)="Sync()"></i>
           <span *ngIf="this.General.LoadSync?.syncEndDate == null" >Synchronizing  <div class="spinner-border mx-2" role="status"></div></span>
           <span *ngIf="this.General.LoadSync?.syncEndDate?.length >0">Last sync date is : {{this.General.LoadSync?.syncEndDate| date:'short'}}</span>
          <i class="fas fa-users-cog navbar-icons"  [routerLink]="['/loan']"  title="InTake Admin" ></i>
          <i class="fab fa-ideal navbar-icons"  title="Assign Mail To MicroDeal" [routerLink]="['/mailToMicrodeal']"></i>
          <i class="fas fa-envelope-open-text navbar-icons" [routerLink]="['/inbox']" ></i>
          <i class="fas fa-upload navbar-icons"  title="Upload Global Data Source" [routerLink]="['/UploadGlobalDataSource']"></i>
          <i class="fas fa-list-ul navbar-icons" title="Lenders" [routerLink]="['/lenders']"></i>
        </ul>
       <button class="navbar-togglernavbar-toggler-right d-lg-none align-self-center" type="button" data-toggle="offcanvas"> <span class="icon-menu"></span></button>
    </div>
  </nav>
</div>
<!-- End Navbar -->
<!-- <div style="background:linear-gradient(-45deg,#06418e,#1572e8)!important; padding: 40px 20px;margin-top: 50px; text-align:center">
  <ng-container *ngIf="Deal.macroDeal?.title">
    <h1 style="font-size: 45px;letter-spacing: 2px;color: #fff;font-family: 'Lato';font-weight: 900;">  {{Deal.macroDeal.title}} </h1>
   </ng-container>
   <ng-container *ngIf="Deal.macroDeal.address ||Deal.macroDeal.city" >
       <span style="color: #fff; font-size: 21px;letter-spacing: 1px;">  {{Deal.macroDeal.address}} , <b>{{Deal.macroDeal.city}}</b></span>
   </ng-container>
    <div *ngIf="Deal.macroDeal.description" style="font-size: 15px ;text-align: justify;margin-top: 16px;">
      <span class="description">{{Deal.macroDeal.description}} </span>
    </div>
 </div> -->
<!-- Start Into-->

  <div class="row" style="margin-top: 40px; margin-inline: 0;">
    <div class="col-md-2" style="padding-inline:0">
      <div class="poplinks float-left">
        <div class="side-btn-container">
         <div type="button" class="btn control-box-btn" data-toggle="modal" data-target=".bd-example-modal-lgParam1"
         (click)="GetDealParametars()">
         <i class="fas fa-list mr-2"></i>Macro Deal Parameters</div>
       </div>
       <div class="side-btn-container">
        <div type="button" class="btn control-box-btn" (click)="open(CreateScenario,null)">
          <i class="fas fa-plus mr-2"></i>Create Scenario</div>
       </div>
        <div class="side-btn-container">
          <div type="button" class="btn control-box-btn" [ngClass]="statusTemplate ? 'successTemp' : 'danger'" (click)="ShowTemplate()" title="Templates">
            <i class="far fa-clipboard mr-2"></i>Template</div>
        </div>

        <div class="side-btn-container">
           <div type="button" class="btn control-box-btn" [ngClass]="statusData ? 'successData' : 'danger'"  (click)="ShowDataSources()">
            <i class="fas fa-database mr-2"></i> Data Sources </div>
        </div>
        <div class="side-btn-container">
           <div type="button" class="btn control-box-btn" [ngClass]="statusGallery ? 'successGallery' : 'danger'"  (click)="ShowGallery()">
             <i class="fas fa-images mr-2"></i>Gallery</div>
        </div>
        <div class="side-btn-container">
          <div type="button" class="btn control-box-btn" [ngClass]="statusFiles ? 'successFiles' : 'danger'"  (click)="ShowFiles()">
            <i class="fas fa-file mr-2"></i>Files Library </div>
        </div>
        <div class="side-btn-container">
          <div type="button" class="btn control-box-btn" [ngClass]="statusSenario ? 'successSenario' : 'danger'"  (click)="ShowScenarios()">
            <i class="fas fa-chart-bar mr-2"></i>Scenarios</div>
        </div>
        <div class="side-btn-container">
         <ng-container *ngIf="Deal?.macroDeal!=null" >
           <div type="button" class="btn control-box-btn" [ngClass]="statusIntake ? 'successSenario' : 'danger'" (click)="ShowIntake()">
            <i class="fas fa-server mr-2"></i>Intake Values</div>
          </ng-container>
      </div>
      </div>
    </div>

<div class="col-md-10 " style="padding-inline : 0; background-color: #f7f7f7;">
<div style="background:linear-gradient(-45deg,#06418e,#1572e8)!important; padding: 40px 20px; text-align:center">
  <ng-container *ngIf="Deal.macroDeal?.title">
    <h1 style="font-size: 45px;letter-spacing: 2px;color: #fff;font-family: 'Lato';font-weight: 900;">  {{Deal.macroDeal.title}} </h1>
   </ng-container>
   <ng-container *ngIf="Deal.macroDeal.address ||Deal.macroDeal.city" >
       <span style="color: #fff; font-size: 21px;letter-spacing: 1px;">  {{Deal.macroDeal.address}} , <b>{{Deal.macroDeal.city}}</b></span>
   </ng-container>
    <div *ngIf="Deal.macroDeal.description" style="font-size: 15px ;text-align: justify;margin-top: 16px;">
      <span class="description">{{Deal.macroDeal.description}} </span>
    </div>
 </div>

<!--Start Template-->
 <div *ngIf="OpenTemplate">
    <div class="container-fluid">
      <div class="modal-body-template">
        <h1 style="font-weight: 600;letter-spacing: 1px;font-size: 3rem; color:#284b63; text-align: center;   font-family: 'Lato', sans-serif !important;">
          Template</h1>
        <!-- <h1 style="text-align: center;font-size: 32px; letter-spacing: 4px;">Template</h1> -->
        <div style="margin-bottom:0.5rem" >
          <h1 style="font-size: 16px;line-height: 1;letter-spacing: 1px;vertical-align: top;font-weight: 600; margin-bottom:5px">Select Template To Edit</h1>
            <select name="slctTemp" id="slct" (change)="GetTemplateBody()" [(ngModel)]="General.SelectedTemplate.name" style="font-size: 14px;
            border-color: #c8c8ca;padding: 0.6rem 1rem;height: inherit!important;line-height: 1.5;color: #495   057;background-color: #fff;border-radius: 0.25rem;">
                <option selected >Select Template</option>
                <option *ngFor="let temp of General.Templates" [ngValue]="temp.name">{{temp.name}}</option>
            </select>
        </div>
          <form>
            <div class="form-group" style="margin-bottom:0.5rem">
                <label for="recipient-name" class="col-form-label" style="margin-bottom:5px ;padding-bottom:5px;font-size:16px;font-weight: 600;">Email subject / Template name</label>
                <input type="text" style="width:280px; border-color: #c8c8ca; border-radius: 5px;" class="form-control" [(ngModel)]="General.SelectedTemplate.name" name="tmeplateName">
            </div>
            <div class="form-group">
              <label for="recipient-name" class="col-form-label" style="margin-bottom:0 ;padding-bottom:5px"> <b> Email body / Template body : </b> </label>
                <ejs-richtexteditor #templateRTE [toolbarSettings]='tools' [(ngModel)]='General.SelectedTemplate.body' name="templateRTE"></ejs-richtexteditor>
                  <ejs-dialog #templateDialog id="Dialog" [buttons]='dlgButtons'  (overlayClick)="dialogOverlay()" [header]='header' [visible]='false'
                    [showCloseIcon]='true'  (created)="dialogCreate()" [isModal]='true'>
                      <ng-template #content>
                        <div id="rteSpecial_char">
                          <h3> <b> Contact Data </b> </h3>
                          <div>
                            <div class="btn btn-primary m-1 " title="Firstname"
                              (click)="insertPersonalization('#Person.contact.firstName#')"> #Person.contact.firstName#</div>
                            <div class="btn btn-primary m-1" title="Lastname"
                              (click)="insertPersonalization('#Person.contact.lastName#')"> #Person.contact.lastName#</div>
                            <div class="btn btn-primary m-1" title="email"
                              (click)="insertPersonalization('#Person.contact.email#')"> #Person.contact.email#</div>
                            <div class="btn btn-primary m-1" title="phone"
                              (click)="insertPersonalization('#Person.contact.phone#')">  #Person.contact.phone#</div>
                          </div>
                          <br> <br>
                          <h3> <b> Deal Data </b> </h3>
                          <div class="btn btn-danger m-1" title="title"
                            (click)="insertPersonalization('#Deal.data.title#')">#Deal.data.title#</div>
                                <div style="display: inline-block;" *ngFor="let Field of Deal.customFields?.dealCustomFieldMeta;">
                            <div class="btn btn-danger m-1" title="Parameter.{{Field.fieldLabel}}"
                              (click)="insertPersonalization('#Parameter.'+Field.fieldLabel+'#')">#Parameter.{{Field.fieldLabel}}#
                            </div>
                          </div>
                          </div>
                      </ng-template>
                  </ejs-dialog>
            </div>
          </form>
          <div style="display:flex; justify-content: center;">
          <button type="button" class="btn " style="background-color:#31ce36;border-color: #31ce36; color:#fff ;padding: 13px 60px;     font-size: 16px;
          letter-spacing: 2px;"
            (click)="SaveTemplate()">Save</button>
          </div>
      </div>
    </div>
 </div>
<!--End Template-->

<!-- Start Files -->
<div *ngIf="OpenFiles" style="padding:20px">
  <div class="center mt-2">
    <h1 style="font-weight: 600;letter-spacing: 1px;font-size: 41px; color:#284b63; text-align: center;   font-family: 'Lato', sans-serif !important;">
      Upload Files here</h1>
    <ngx-file-drop dropZoneLabel="Drop files here" (onFileDrop)="droppedFiles($event)" [dropZoneClassName]="'upload-background-image'"
    (onFileOver)="fileOver($event)" (onFileLeave)="fileLeave($event)">
        <ng-template ngx-file-drop-content-tmp let-openFileSelector="openFileSelector">
        <span style="color:#fff;">  Drop Files Here </span>
          <button type="button" class="btn btn-success ml-2" style="padding: 5px 10px ;" (click)="openFileSelector()">Browse Files</button>
        </ng-template>
    </ngx-file-drop>
  </div>
  <table *ngIf="General.AllFiles.files.length > 0" class="table table-bordered file-table" style="border-right:2px solid #beced8">
    <thead>
        <tr>
          <th class="file-table-head">File Name</th>
          <th class="file-table-head">Category</th>
          <th class="file-table-head">Privilege</th>
          <th class="file-table-head">Actions</th>
        </tr>
    </thead>
<tbody>
  <tr *ngFor="let file of General.AllFiles.files ; let i= index">
    <td style="width: 20px;"><span style="font-size: 15px;">{{i+1}}- {{file.name}}</span>
    </td>
    <td style="width: 20px;">
    <div >
      <select [(ngModel)]="file.categoryId" style="font-size: 14px;
      border-color: #c8c8ca;padding: 0.6rem 1rem;height: inherit!important;line-height: 1.5;color: #495   057;background-color: #fff;border-radius: 0.25rem;">
        <option *ngFor="let category of General.categories"
                [ngValue]="category.id"
                [attr.selected]=" file.categoryId == category.id ? true : null">
                {{category.name}}
        </option>
    </select>
    </div>
  </td>
    <td> <span id="priv" class="file-privilege" > {{getPrivilege(file)}}</span>
      <br>

      <input class="mt-3" type="checkbox" id="Deal"
      (change)="checkDeal($event ,file)"
      [disabled]="file.CheckDeal"
      [checked]="IsCheckedDeal(file)"
      value="Deal"
      name="GroupId" > Deal

      <div *ngFor="let Scenario of General.Scenarios" class="mt-1">
        - {{Scenario.title}}
        <div *ngFor="let group of Scenario.groups" class="mt-1" style="cursor: pointer;">
          <input  type="checkbox" id="Group"
          (change)="checkDeal($event  , file , group)"
          [disabled]="file.CheckGroup"
          [checked]="IsCheckGroup(file ,group)"
          name="GroupId"
          value="{{group.id}}"> <span class="ml-2">{{group.title}}</span>
        </div>
      </div>
    </td>
    <td class="file-icons" >

      <a href="https://groundlease.app.box.com/file/{{file.boxId}}" target="_blank"
        title="View" style="color: #000000; margin-left: 9px;"><i class="fas fa-eye" style="cursor: pointer;"></i> </a>

      <i class="fas fa-trash-alt ml-2" style="cursor: pointer;" title="Delete" (click)="deleteFileDeals(file)"></i>
    </td>
  </tr>
</tbody>
</table>
<div style="justify-content: center; display: flex;">
<button class="btn btn-primary  mt-2 mb-2" (click)="UpdateFiles()"
style="background-color: #26de81;border-color: #26de81;color: #fff;">Update Files</button>
</div>

<table  class="table table-bordered file-table" style="border-right:2px solid #c1c1c1">
  <thead>
      <tr>
        <th class="file-table-head"> File Type </th>
        <th class="file-table-head"> Message </th>
      </tr>
  </thead>
  <tbody>
    <tr *ngFor="let category of General.categories">
      <td>
        <!-- [checked]="item.required == 1" -->
        <input class="mr-1 mt-2" type="checkbox" id="Deal" value="Deal" name="GroupId"
        (change)="checkType($event ,category)" >{{category.name}}</td>
      <td *ngIf="category.showMessage ==  true">
        <input   type="text" style="width: 75%;" placeholder="Enter Message" [(ngModel)]="category.message">
        <button style="margin-left: 32px;padding: 8px 28px;" class="btn btn-success" (click)="SendType(category)">Save</button></td>
    </tr>
  </tbody>
  </table>
</div>
<!-- End Files -->


<!-- Start Data Source -->
<div *ngIf="OpenDataSources" style="padding: 20px;">
  <h1 style="font-weight: 600;letter-spacing: 1px;font-size: 41px; color:#284b63; text-align: center;   font-family: 'Lato', sans-serif !important;">
    Upload Data Sources</h1>
  <div class="center mt-2">
    <ngx-file-drop dropZoneLabel="Drop files here" (onFileDrop)="DroppedDataSources($event)"  [dropZoneClassName]="'upload-background-image'"
    (onFileOver)="fileOver($event)" (onFileLeave)="fileLeave($event)">
        <ng-template ngx-file-drop-content-tmp let-openFileSelector="openFileSelector">
          <span style="color:#fff">Drop Data Sources Here</span>
          <button type="button" class="btn btn-success ml-2" style="padding: 5px 10px ;" (click)="openFileSelector()">Browse Files</button>
        </ng-template>
    </ngx-file-drop>
  </div>
    <div class="mt-5" *ngIf="General.DataSources?.length >0">
      <div class="col-md-12" style="padding-left: 0;">
        <div class="card">
          <table class="table table-bordered" style="border-collapse: collapse;  width: 100%;border: 2px solid #beced8;">
              <thead>
                <tr>
                  <th style="color: #575962; text-align: center; font-size:20px">Files</th>
                  <th style="color: #575962; text-align: center; font-size:20px">Actions</th>
                </tr>
              </thead>
              <tbody>
                <tr *ngFor="let item of General.DataSources ; let i =index">
                  <td style="color: black; text-align:center;">{{i+1}}-  <span *ngIf="item.macroDealId==null">[ Global ] </span> <span *ngIf="item.macroDealId!=null">[ Local ] </span> {{item.filename}}</td>
                  <td style="text-align: center; display: flex; justify-content: space-evenly;font-size: 18px;">
                    <button class="btn btn-success sync-ds" (click)="SyncDataSource(item)">Sync</button>

                    <i class="fas fa-exchange-alt" title="mapping" style="cursor: pointer;" (click)="GetDataSourceNameRanges(item)"></i>
                     <i class="fas fa-trash-alt custom-delete" title="Delete" style="margin-left: 0;" (click)="DeleteDataSource(item.id)"></i>
                    <a style="color: #000000; margin-left: 10px; cursor: pointer;"
                    href="https://groundlease.app.box.com/file/{{item.boxId}}" target="_blank"
                    title="View Excel"  class="download-file"> <i class="fas fa-eye " style="font-size: 19px;
                    margin-left: 2px;"></i></a>
                  </td>
                </tr>
              </tbody>
            </table>
        </div>
      </div>
   </div>
     <!-- Start Mapping Table -->

  <div class="mt-4" *ngIf=" General.DataSources && General.DataSources.length>0">
    <div class="col-md-12" style="padding-left:0">
      <div class="card">
        <div style="display: flex; justify-content: space-between;">

          <h5 class="mapping" style="cursor: pointer; text-align: center; width: 100%;" (click)="ShowMappingTable()">Show Mapping Table</h5>
          <i class="fas fa-times" style="font-size: 25px; cursor: pointer;   margin-top: 10px;
          margin-left: 13px; display: flex;  justify-content: end;" *ngIf="ExictMappingTable" (click)="CloseTable()"></i>
        </div>
        <table class="table table-striped table-bordered action-table" *ngIf="ExictMappingTable" >
          <thead>
            <tr>
              <th style="color:rgb(21, 40, 60); background-color: #f5f5f5; text-align: center; font-size: 20px;">Files </th>
              <th style="color:rgb(21, 40, 60); background-color: #dcdde1; text-align: center; font-size: 20px;">Map</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let item of General.DataSources ; let i =index">
              <td style="color: black; text-align:center;">{{i+1}}- {{item.filename}}</td>
              <ng-container *ngFor="let map of item.dataSourceMaps" >
                <td *ngIf="map.sheet!=null" style="text-align: center; display: flex; font-size: 18px; ">
                  <table style="width: 100%;  border-collapse: collapse;
                  width: 100%;">
                    <thead>
                      <tr>
                        <th style="color:rgb(21, 40, 60); background-color: #f5f5f5; text-align: start; font-size: 20px;">Sheet</th>
                        <th style="color:rgb(21, 40, 60); background-color: #f5f5f5; text-align: start; font-size: 20px;">Cell</th>
                        <th style="color:rgb(21, 40, 60); background-color: #f5f5f5; text-align: start; font-size: 20px;">Items</th>
                      </tr>
                    </thead>
                    <tbody>
                      <tr>
                        <td style=" width: 30%; text-align: start;">{{map.sheet}}</td>
                        <td style="width: 30%; text-align: start;">{{map.cell}} </td>
                        <td style="width: 40%; text-align: start; letter-spacing: 1px;">{{getItemName(map.itemIds)}}</td>
                      </tr>
                    </tbody>
                  </table>
                  </td>
               </ng-container>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>
 <!-- End Mapping Table -->
</div>

<br>
<div class="card"  *ngIf="openDataSourceForm">
  <div class="card-body">
    <div style=" padding: 15px;">
      <div style="background-color: #f9f9f9; padding: 12px;">
        <h5 class="mapping" >Mapping Data Sources</h5>
        <h1 style="font-weight: 600;">{{DataSourceTitle}}</h1>
        <br>
        <div style="display: flex; margin-bottom: 15px;">
        <h2 style="margin: 0;   font-weight: 400;">- Select Tab :</h2>
        <div  style="margin-left: 19px;" >
          <select  [(ngModel)]="Sheet">
            <option selected>Tabs</option>
            <option *ngFor="let NameRange of General.NameRange">{{NameRange.label}}</option>
          </select>
        </div>
      </div>

      <div class="cell" style="margin-bottom: 15px;" *ngIf="General.NameRange?.length>0">
         <span style="font-size: 20px;font-weight: 400;">- Cell :</span><input type="text" class="cellx" [(ngModel)]="Cell" name="TextArea">
      </div>

      <div style="display: flex;">
      <h2 style="margin: 0;     font-weight: 400;">- Select Type :</h2>
      <div   *ngIf="General.NameRange?.length>0" style="margin-left: 10px;" >
        <select (change)="initIntake($event)">
          <option selected>Types</option>
          <option *ngFor="let item of StartIntake" value="{{item.id}}">
            {{item.displayName}}</option>
        </select>
      </div>
    </div>
    </div>
  </div>
  </div>
</div>

<div class="col-lg-12 grid-margin stretch-card"  *ngIf="openDataSourceForm">
  <div class="card">
    <div class="card-body" style="margin-top: 0;">
      <table class="table table-striped table-bordered action-table" >
        <thead>
          <tr>
            <th>Screen name</th>
            <th>Items</th>
          </tr>
        </thead>
        <tbody>
          <ng-container *ngFor="let screenId of screenIds">
            <tr style="cursor: pointer;">
              <td>{{getScreenName(screenId)}} </td>
              <td>
                <p *ngFor="let item of GetScreenItems(screenId)">
                  <input (change)="checkdatasource($event)" type="checkbox" id="input{{item.id}}" name="itemid" class="mr-2"
                    value="{{item.id}}"> {{item.name}}
                </p>
              </td>
            </tr>
          </ng-container>
        </tbody>
      </table>
      <div style="float:right;margin: 10px 0;">
        <button class="btn btn-success"  (click)="SaveMapping()" *ngIf="screenIds.length>0">Save</button>
      </div>
    </div>
  </div>
</div>

<ng-template  let-modal #content>
  <div class="modal-content-createScenario">
    <div class="modal-body-createScenario" style="padding: 20px;">
      <h5 style="letter-spacing: 1px;font-size: 23px; font-weight: 400;margin-bottom: 26px;">- Did you want SUM or OR ?</h5>
      <div style="display: flex ; flex-direction: row; justify-content: flex-end;">
        <button class="btn btn-success" style="   background-color: #192a56; border-color: #192a56;" (click)="SumOrOR(2)">Sum</button>
        <button class="btn btn-danger" style="margin-left:14px" (click)="SumOrOR(1)">Or</button>
      </div>

    </div>
  </div>
</ng-template>
<!-- End Data Source -->


<!-- Start Gallery  -->
<div *ngIf="OpenGallery" style="padding: 0 20px;">
  <form [formGroup]="uploadFormMainImage" style="display: flex; justify-content: center;">
    <h1 style="font-weight: 600;letter-spacing: 1px;font-size: 41px; color:#284b63; text-align: center;   font-family: 'Lato', sans-serif !important;">
      Upload Main Image</h1>
    <input type="file" class="ml-4" style="margin-top:6px" name="profile" (change)="UploadMainImage($event)"/>
  </form>
        <div class="row"  class="main-image-row">
      <div *ngFor="let image of Deal.MainImage">
          <div style="width:500px;">
          <img style="max-width:500px;max-height:300px" src="http://40.76.123.27:8096/api/deal/Image?dealId={{Deal.macroDeal.pipedriveId}}&image={{image}}"/>
          <button type="button" class="btn btn-danger mt-1 mb-3 d-block mx-auto"
            (click)="DeleteImage(image)" style="padding: 5px 10px;">Delete</button>
        </div>
      </div>
  </div>
<hr>

<div style="margin:10px 0 10px">
<h1 style="font-weight: 600;letter-spacing: 1px;font-size: 41px; color:#284b63; text-align: center;   font-family: 'Lato', sans-serif !important;">
    Upload Deal Images</h1>
 <div class="center mt-2">
      <ngx-file-drop dropZoneLabel="Drop files here" (onFileDrop)="UploadImages($event)"  [dropZoneClassName]="'upload-background-image'"
      (onFileOver)="fileOver($event)" (onFileLeave)="fileLeave($event)">
          <ng-template ngx-file-drop-content-tmp let-openFileSelector="openFileSelector">
          <span style="color:#fff">Drop Images Here</span>
            <button type="button" class="btn btn-success ml-2" style="padding: 5px 10px ;" (click)="openFileSelector()">Browse Images</button>
          </ng-template>
      </ngx-file-drop>
      </div>
  </div>
  <div class="main-image">
    <div class="row" style="margin: 40px 0px;">
      <ng-container *ngFor="let image of Deal.images">
        <div class="col-lg-4 col-md-6">
          <img style="max-width:300px;max-height:300px" src="http://40.76.123.27:8096/api/deal/Image?dealId={{Deal.macroDeal.pipedriveId}}&image={{image}}"/>
          <button type="button" class="btn btn-danger mt-2 mb-3 d-block mx-auto" (click)="DeleteImage(image)" style="padding: 5px 10px;">Delete</button>
      </div>
    </ng-container>
    </div>
  </div>

</div>
<!-- End Gallery -->


<!-- Start Intakevales  -->
<div *ngIf="OpenIntake">
  <app-intakevalues></app-intakevalues>
</div>
<!-- End Intakevales -->

<!-- Start Scenario -->
<div *ngIf="OpenTable">
  <div class="col-lg-12">

      <div class="card-body" style="padding: 0;">


        <table class="table table-striped " *ngIf="Deal && Deal.Scenarios"
        style="box-shadow: rgba(0, 0, 0, 0.24) 0px 3px 8px; border-radius:5px ;">
          <thead>
            <tr style="background-color:#1269db!important ;">
                <th class="senario-head">Scenario</th>
                <th class="senario-head">Creation Date</th>
                <th class="senario-head">Create Group</th>
                <th class="senario-head">Delete Scenario</th>
                <!-- <th style="text-align: center; border-right: 1px solid #fff;">Delete Scenario</th> -->
            </tr>
          </thead>
          <tbody>
            <ng-container *ngFor="let Scenario of Deal.Scenarios">
              <tr>
                <td  scope="row" (click)="GetScenarioGroups(Scenario)" class="scenario-title">
                    {{Scenario.title}}
                  </td>
                <td style="text-align: center; font-size:16px"> <b> {{Scenario.creationDate | date}} </b>
                 </td>
                <td style="text-align: center;"> <button type="button" class="create-group-btn createGroup" data-toggle="modal"
                      data-target=".bd-example-modal-smCG" (click)="open(CreateGroup,Scenario)">Create Group</button>
                </td>

                <td style="text-align: center;">
                   <button type="button" class="delete-scenario-btn createGroup" data-toggle="modal"
                  data-target=".bd-example-modal-smCG" (click)="open(DeleteScenarioModal , Scenario)">Delete Scenario</button>
                </td>
                <!-- <td><i class="fas fa-trash-alt custom-delete" (click)="open(DeleteScenarioModal , Scenario)"></i></td> -->
                <!-- <td style="text-align: center;"> <i class="fas fa-trash-alt custom-delete" (click)="open(DeleteScenarioModal , Scenario)"></i>  </td> -->
              </tr>
              <tr *ngIf="Scenario.openScenario" style="background-color:#e3e2e2">
                <td colspan="10" style="padding:0; margin:0" scope="row">
                  <div *ngFor="let group of Scenario.groups">
                    <div class="groupDeal">
                      <div class="grpTitle">
                          <span class="group-title" (click)="GetGroupMicroDeals(group)">{{group.title}}</span>
                          <div class="dropdown">
                              <button class="btn actions-dropdown dropdown-toggle" type="button" data-toggle="dropdown">Group Actions<span class="caret"></span></button>
                              <ul class="dropdown-menu">
                                <li><button (click)="LoadMembers(group);openLg(Member,group)" class="dropdown-btns">Add Organization</button> </li>
                                <li><button (click)="open(CreateMember , group)" class="dropdown-btns">Create Member</button></li>
                                <li><button (click)="open(Files , group)" class="dropdown-btns">Files</button></li>
                                <li><button (click)="openGroupParam(Parameters , group)" class="dropdown-btns">Parameters</button></li>
                                <li><button (click)="OpenLandingPages(group ,Scenario)" class="dropdown-btns">Excel data tables</button></li>
                                <li><button class="dropdown-btns" > <a href="https://lender.capsnap.ai/page?groupId={{group.id}}"
                                     target="_blank" class="link-btn">Open Landing Page</a> </button></li>
                                <li><button  (click)="openDeleteGroupModal(DeleteGroupModal ,group , Scenario)" class="dropdown-btns">Delete Group</button></li>
                                <li><button class="create-member-btn ml-3" [ngClass]="{'InActive': group.landingPageActive == 0 }"
                                  (click)="ToggleLandingPage(group ,Scenario)"> {{group.landingPageActive == 0 ? 'InActive' : 'Active'}} </button></li>
                              </ul>
                            </div>
                            <!-- <div style="display: inline-block;">
                              <button (click)="LoadMembers(group);openLg(Member,group)"
                                class="add-member-btn addMember ml-3">Add Organization</button>
                                <button class="create-member-btn addMember ml-3"  [ngClass]="{'InActive': group.landingPageActive == 0 }"
                                   (click)="ToggleLandingPage(group ,Scenario)"> {{group.landingPageActive == 0 ? 'InActive' : 'Active'}} </button>
                              <button (click)="open(CreateMember , group)" class="create-member-btn addMember ml-3 ">Create Member</button>
                              <button (click)="open(Files , group)" class="create-member-btn addMember ml-3 ">Files</button>
                              <button (click)="openGroupParam(Parameters , group)" class="create-member-btn addMember ml-3 ">Parameters</button>
                              <button  class="create-member-btn addMember ml-3 " (click)="OpenLandingPages(group)">Landing Pages</button>
                              <button  class="create-member-btn addMember ml-3" >
                                  <a href="http://40.76.123.27:8098/page?groupId={{group.id}}" target="_blank"
                                  style=" text-decoration: none;">Open Landing Page</a> </button>

                              <button class="create-member-btn addMember ml-3" (click)="openDeleteGroupModal(DeleteGroupModal ,group , Scenario)">Delete Group</button>
                            </div> -->
                        </div>
                    <div>

                    <!-- Start GroupLanding Page -->
                    <div *ngIf="group.closeLandingPage" >
                      <div style="display: flex;
                      justify-content: space-between;background-color: rgb(21, 40, 60);margin-top: 10px;padding: 0 11px;border-radius: 5px;">
                        <h1 style="text-align: center; color: #fff;
                        margin-top: 15px; width: auto;">New Formula</h1>
                        <i class="fas fa-times" (click)="group.closeLandingPage=false"
                        style="margin-block: auto; font-size: 20px; cursor: pointer; color:#fff"></i>
                      </div>

                      <div style=" margin-left: 9px;">
                      <div style="display: flex;" class="mt-2">
                        <p style="margin-top: 10px;margin-right: 82px; font-size:20px"><b>Select File:</b></p>
                          <div class="mt-1">
                            <select name="select Category mr-5" style="padding: 7px;border-radius: 4px;" (change)="GetDataSourceNameRange($event ,group)"   >
                              <option selected >Select File:</option>
                              <option *ngFor="let data of General.DataSource" value="{{data.id}}">
                                <span *ngIf="data.macroDealId==null">[ Global ] </span> <span *ngIf="data.macroDealId!=null">[ Local ] </span>{{data.filename}}</option>
                            </select>
                        </div>

                        <button class="btn" *ngIf="General.ChartsSheet.length>0"
                         style="background-color: #2ecc71; border: 1px solid #2ecc71;color: #fff;border-radius: 7px ; letter-spacing: 1px; margin-left: 34px;"
                        (click)="Viewcharts=!Viewcharts">{{Viewcharts ? 'Hide Charts':'Show Charts'}}</button>
                        <button class="btn" *ngIf="General.fileId!=null"
                         style="background-color: #2ecc71; border: 1px solid #2ecc71;color: #fff;border-radius: 7px ; margin-left: 34px;"
                         (click)="CopyDataSources(group,Scenario)">Copy Data Source</button>
                      </div>
                      <div style="display:flex; margin-block:25px;">
                          <p style="margin-top: 10px;margin-right: 43px;  font-size:20px">
                          <b>Select Tab:</b></p>
                          <div class="mt-1" style="margin-left: 38px;">
                            <select name="select Category mr-5" (change)="SelectNameRange($event ,group)"   style="padding: 7px;border-radius: 4px;" >
                              <option selected >Select Name Range:</option>
                              <ng-container  *ngFor="let nameRange of General.NameRange">
                                <option *ngIf="nameRange.type == 'Tab'" value="{{nameRange.label}}">
                                    [ {{nameRange.type}} ] {{nameRange.label}}
                              </option>
                            </ng-container>
                            </select>
                          </div>
                          <button class="btn" *ngIf=" General.Sheets.length>0"
                            style="background-color: #2ecc71; border: 1px solid #2ecc71;color: #fff;border-radius: 7px ; margin-left: 34px; letter-spacing: 1px;"
                           (click)="ViewReadFormula=!ViewReadFormula">{{ViewReadFormula ? 'Hide Data':'Show Data'}}</button>
                          <br>

                          <!-- <button style="background-color: #2ecc71;  border: 1px solid #2ecc71;color: #fff;border-radius: 16px"
                          class="btn float-right ml-4" (click)="ViewNamedRanges(group)">View Named Ranges</button> -->
                      </div>
                      <div style="display: flex;">
                        <p style="margin-top: 10px;margin-right: 10px; font-size:20px">
                          <b>Custom Formula:</b></p>
                          <input type="text" class="mt-1" style="border-radius: 5px;border: 1px solid #7f8c8d;
                          margin-left:17px;width: 282px;" [(ngModel)]="General.TextArea" name="TextArea">

                          <i class="far fa-eye" *ngIf="General.TextArea?.length >0"
                          style="margin-top: 11px;margin-left: 16px;font-size: 24px; cursor: pointer;" (click)="ViewFormula(group)"></i>
                          <!-- <button style="background-color: #2ecc71;  border: 1px solid #2ecc71;color: #fff;border-radius:4px"
                          class="btn float-right ml-4" (click)="ViewFormula(group)">View</button> -->
                      </div>
                      </div>
                      <div>

                      <div *ngIf="Viewcharts && General.ChartsSheet.length>0" >
                          <div *ngFor="let chart of General.ChartsSheet"
                           style="border: 1px solid #bdc3c7;padding: 10px;border-radius: 4px; margin-block: 20px; background-color: #fff;">

                          <div style="display: flex;">
                              <svg preserveAspectRatio="xMidYMid meet" data-bbox="40.026 40.026 319.948 319.948"
                            viewBox="40.026 40.026 319.948 319.948" height="45" width="45" xmlns="http://www.w3.org/2000/svg" data-type="color" style="margin-right:10px ; width: 35px;"
                              role="presentation" aria-hidden="true"><defs><style>#comp-jxg2gae811 svg [data-color="1"] {fill: #000000;}</style></defs>
                            <g>
                                <path d="M200 40.026c-88.351 0-159.974 71.623-159.974 159.974S111.649 359.974 200 359.974c88.352 0 159.974-71.623 159.974-159.974S288.352 40.026 200 40.026zm17.786 228.68h-50.202l-.638-1.422.054-.117-12.914-28.099v-.001l-35.254-76.47h51.493l22.422 48.548 36.928-79.852h51.494l-63.383 137.413z" fill="#000001" data-color="1"></path>
                                <path fill="#000001" opacity=".3" d="M192.747 211.146l-25.039 57.56-10.601-23.065 17.82-73.079 17.82 38.584z" data-color="1"></path>
                            </g>
                              </svg>
                              <input type="checkbox" style="margin: 15px 0px;" (change)="CheckChart($event,chart)" [attr.checked]="chart.isAvailableChart">
                          </div>
                          <h2>{{chart.label}}</h2>
                          <img style="width:auto;height:auto" src="http://groundlease.tripgenius.com/{{Deal.macroDeal.pipedriveId}}/charts/{{chart.label}}"/>


                            <div class="container-fluid">
                              <div class="row" >
                                  <div class="col-md-3">
                                    <p style="margin-top: 10px;margin-right: 10px;">
                                      <b> Title :</b></p>
                                      <input type="text" class="form-control" style="border-radius: 3px;border: 1px solid #7f8c8d;"  placeholder="Enter Title"
                                      [(ngModel)]="chart.title" name="Title" required>
                                  </div>

                                <div class="col-md-3">
                                  <p style="margin-top: 10px;margin-right: 10px;">
                                  <b> Intro :</b></p>
                                  <textarea class="form-control"  id="exampleFormControlTextarea1" rows="1"
                                  [(ngModel)]="chart.intro"  placeholder="Enter Intro"></textarea>
                                </div>
                            </div>
                           </div>

                          </div>
                          <div style="display: flex; justify-content: center;">
                            <button class="btn btn-primary" class="saveNameRanges" (click)="SaveChart(group)">Save Charts</button>
                          </div>
                      </div>
                        <div *ngIf="ViewReadFormula && General.Sheets.length>0">
                          <div *ngFor="let item of General.Sheets"
                           style="border: 1px solid #bdc3c7;padding: 10px;border-radius: 4px; margin-block: 20px; background-color: #fff;">
                          <div style="display: flex;">
                            <svg preserveAspectRatio="xMidYMid meet" data-bbox="40.026 40.026 319.948 319.948"
                            viewBox="40.026 40.026 319.948 319.948" height="45" width="45" xmlns="http://www.w3.org/2000/svg" data-type="color" style="margin-right:10px ; width: 35px;"
                              role="presentation" aria-hidden="true"><defs><style>#comp-jxg2gae811 svg [data-color="1"] {fill: #000000;}</style></defs>
                            <g>
                                <path d="M200 40.026c-88.351 0-159.974 71.623-159.974 159.974S111.649 359.974 200 359.974c88.352 0 159.974-71.623 159.974-159.974S288.352 40.026 200 40.026zm17.786 228.68h-50.202l-.638-1.422.054-.117-12.914-28.099v-.001l-35.254-76.47h51.493l22.422 48.548 36.928-79.852h51.494l-63.383 137.413z" fill="#000001" data-color="1"></path>
                                <path fill="#000001" opacity=".3" d="M192.747 211.146l-25.039 57.56-10.601-23.065 17.82-73.079 17.82 38.584z" data-color="1"></path>
                            </g>
                            </svg>
                            <input type="checkbox" style="margin: 15px 0px;" (change)="CheckExcel($event,item)" [attr.checked]="item.isAvailable">
                            <h2 style="margin-top: 4px;margin-left: 7px;font-size: 19px;">{{item.label}}</h2></div>
                            <table class="table table-bordered mt-3">
                              <tbody>
                                <tr *ngFor="let x of GetRowsx(item); let i = index">
                                  <td *ngFor="let cell of GetRowCellsx(x ,item)">   {{cell.value}}  </td>
                                </tr>
                              </tbody>
                            </table>
                            <div class="container-fluid">
                              <div class="row" >
                                  <div class="col-md-3">
                                    <p style="margin-top: 10px;margin-right: 10px;">
                                      <b> Title :</b></p>
                                      <input type="text" class="form-control" style="border-radius: 3px;border: 1px solid #7f8c8d;"  placeholder="Enter Title"
                                      [(ngModel)]="item.title" name="Title" required>
                                  </div>
                                  <div class="col-md-3">
                                    <p style="margin-top: 10px;margin-right: 10px;">
                                    <b> Columns :</b></p>
                                    <input type="number" class="form-control" style="border-radius: 3px;border: 1px solid #7f8c8d;"  placeholder="Enter Columns"
                                    [(ngModel)]="item.GroupDataSource.columns" name="Columns">
                                  </div>
                                <div class="col-md-3">
                                  <p style="margin-top: 10px;margin-right: 10px; ">
                                  <b> Headers :</b></p>
                                  <input type="text" class="form-control" style="border-radius: 3px;border: 1px solid #7f8c8d;"  placeholder="Enter Headers"
                                  [(ngModel)]="item.GroupDataSource.headers" name="Headers">
                                </div>
                                <div class="col-md-3">
                                  <p style="margin-top: 10px;margin-right: 10px;">
                                  <b> Intro :</b></p>
                                  <textarea class="form-control"  id="exampleFormControlTextarea1" rows="1"
                                  [(ngModel)]="item.GroupDataSource.intro"  placeholder="Enter Intro"></textarea>
                                </div>
                            </div>
                           </div>

                          </div>
                          <div style="display: flex; justify-content: center;">
                            <button class="btn btn-primary" class="saveNameRanges" (click)="SaveAllNamedRanges(group)">Save</button>
                          </div>
                      </div>
                      <div *ngIf="customFormala"  style="border: 1px solid #bdc3c7;padding: 10px;border-radius: 4px; margin-block: 20px; background-color: #fff;" >
                        <div style="display: flex;padding: 15px 0px 1px 0px;">
                          <svg preserveAspectRatio="xMidYMid meet" data-bbox="40.026 40.026 319.948 319.948"
                          viewBox="40.026 40.026 319.948 319.948" height="45" width="45" xmlns="http://www.w3.org/2000/svg" data-type="color" style="margin-right:10px ;"
                            role="presentation" aria-hidden="true"><defs><style>#comp-jxg2gae811 svg [data-color="1"] {fill: #000000;}</style></defs>
                          <g>
                              <path d="M200 40.026c-88.351 0-159.974 71.623-159.974 159.974S111.649 359.974 200 359.974c88.352 0 159.974-71.623 159.974-159.974S288.352 40.026 200 40.026zm17.786 228.68h-50.202l-.638-1.422.054-.117-12.914-28.099v-.001l-35.254-76.47h51.493l22.422 48.548 36.928-79.852h51.494l-63.383 137.413z" fill="#000001" data-color="1"></path>
                              <path fill="#000001" opacity=".3" d="M192.747 211.146l-25.039 57.56-10.601-23.065 17.82-73.079 17.82 38.584z" data-color="1"></path>
                          </g>
                          </svg>
                          <!-- <input type="checkbox" style="margin: 15px 8px;"  (change)="CheckCustiomFormula($event)" [attr.checked]="General.Sheet?.isAvailable"> -->
                          <h2 style="margin-top: 4px;">{{General.Sheet?.label}}</h2></div>

                          <table class="table table-bordered mt-3">
                            <tbody>
                              <tr *ngFor="let x of GetRows(); let i = index">
                                <td *ngFor="let cell of GetRowCells(x)">   {{cell.value}}  </td>
                              </tr>
                            </tbody>
                          </table>
                          <div class="container-fluid">
                            <div class="row">
                              <div class="col-md-3">
                                <p style="margin-top: 10px;margin-right: 10px;">
                                <b> Title :</b></p>
                                <input type="text" class="form-control" style="border-radius: 3px;border: 1px solid #7f8c8d;"  placeholder="Enter Title"
                                [(ngModel)]="General.Sheet?.GroupDataSource.title" name="Title" required>
                              </div>
                              <div  class="col-md-3">
                                <p style="margin-top: 10px;margin-right: 10px;">
                                <b> Columns :</b></p>
                                <input type="number" class="form-control" style="border-radius: 3px;border: 1px solid #7f8c8d;"  placeholder="Enter Columns"
                                 [(ngModel)]="General.Sheet?.GroupDataSource.columns" name="Columns">
                              </div>
                              <div class="col-md-3">
                                <p style="margin-top: 10px;margin-right: 10px; ">
                                 <b> Headers :</b></p>
                                <input type="text" class="form-control" style="border-radius: 3px;border: 1px solid #7f8c8d;"  placeholder="Enter Headers"
                               [(ngModel)]="General.Sheet?.GroupDataSource.headers" name="Headers">
                             </div>
                             <div class="col-md-3">
                              <p style="margin-top: 10px;margin-right: 10px;">
                              <b> Intro :</b></p>
                              <textarea class="form-control"  id="exampleFormControlTextarea1" rows="1"
                              [(ngModel)]="General.Sheet?.GroupDataSource.intro"  placeholder="Enter Intro"></textarea>
                            </div>
                            </div>
                          </div>
                          <div style="display: flex; justify-content: center; margin-block: 20px;">
                            <button class="btn btn-primary" class="saveNameRanges" (click)="SaveLandingPage(group)">Save </button>
                          </div>
                         </div>

                      <!-- <div *ngIf="customFormala || ViewReadFormula && General.Sheets.length>0" class="landing-page" style="width: 1536px;" >
                        <div style="display:flex;">
                          <p style="margin-top: 10px;margin-right: 10px;">
                          <b> Title :</b></p>
                          <input type="text" class="mt-1" style="border-radius: 3px;border: 1px solid #7f8c8d;
                          margin-left:93px;width: 282px;"  placeholder="Enter Title"
                          [(ngModel)]="General.Sheet?.GroupDataSource.title" name="Title" required>
                        </div>
                        <div style="display:flex; margin-top: 13px;">
                          <p style="margin-top: 10px;margin-right: 10px;">
                          <b> Columns :</b></p>
                          <input type="number" class="mt-1" style="border-radius: 3px;border: 1px solid #7f8c8d;
                          width: 282px; margin-left:62px;"  placeholder="Enter Columns"
                           [(ngModel)]="General.Sheet?.GroupDataSource.columns" name="Columns">
                        </div>
                        <div style="display:flex;">
                          <p style="margin-top: 10px;margin-right: 10px; ">
                          <b> Headers :</b></p>
                          <input type="text" class="mt-1" style="border-radius: 3px;border: 1px solid #7f8c8d;
                          margin-left:65px;width: 284px;"  placeholder="Enter Headers"
                          [(ngModel)]="General.Sheet?.GroupDataSource.headers" name="Headers">
                        </div>
                        <div style="display:flex; margin-top: 13px;">
                          <p style="margin-top: 10px;margin-right: 10px;">
                          <b> Intro :</b></p>
                          <textarea class="form-control"  id="exampleFormControlTextarea1" rows="6"  style="margin-left: 88px; width: 500px;"
                          [(ngModel)]="General.Sheet?.GroupDataSource.intro"  placeholder="Enter Intro"></textarea>
                        </div>
                        <div  style="display: flex;margin-top: 8px;justify-content: flex-end;">
                        <button id="doAddToBasket" name="doAddToBasket" class=" mt-2 btn_2" type="submit" (click)="SaveLandingPage(group)">
                          <span class="arrow_brown">Save Data Table <i class="fas fa-long-arrow-alt-right"></i></span>
                       </button>
                       </div>
                       </div> -->
                      </div>
                       <div *ngIf="General.GroupDataSource?.length>0">
                      <h1 style="text-align: center; color: #fff;background-color: rgb(21, 40, 60); margin-top: 15px; width: auto;" >Current Data Sources</h1>
                        <table class="table table-bordered">
                          <thead>
                            <tr>
                              <th style="color:black ;font-weight: bold;"> File Name </th>
                              <th style="color:black ;font-weight: bold;"> Title </th>
                              <th style="color:black;font-weight: bold;"> Formula </th>
                              <th style="color:black;font-weight: bold;"> Name Range </th>
                              <th style="color:black;font-weight: bold;"> Columns </th>
                              <th style="color:black;font-weight: bold;"> Headers </th>
                              <th style="color:black;font-weight: bold;"> Intro </th>
                            </tr>
                          </thead>
                          <tbody>
                            <tr *ngFor="let item of General.GroupDataSource">
                              <td>{{getDatasourceFileName(item.fileId)}}</td>
                              <td style="display: flex; justify-content: space-between;">{{item.title}}
                               <div class="float-right">
                                  <i class="fas fa-arrow-up up-down" title="Up" (click)="MoveUp(item.id ,group)"></i>
                                  <i class="fas fa-arrow-down ml-2 up-down"  title="Down" (click)="MoveDown(item.id ,group)"></i>
                                  <i class="fas fa-edit ml-2 " style="cursor: pointer;" (click)="EditLandingPage(item)"></i>
                                  <i class="fas fa-trash-alt ml-2" style="cursor: pointer;" (click)="deleteGroupDataSource(item.id ,group)"></i>
                               </div>
                               </td>
                              <td> {{item.formula}}  </td>
                              <td> {{item.namedRange}}  </td>
                              <td> {{item.columns}}  </td>
                              <td> {{item.headers}}  </td>
                              <td style="white-space: pre-line; width: 380px;">   {{item.intro}}  </td>
                            </tr>
                          </tbody>
                        </table>
                      </div>
                      <div *ngIf="UpdateFormula" class="landing-page" style="width: 1536px;">
                        <div style="display:flex;">
                          <p style="margin-top: 10px;margin-right: 10px;">
                          <b> Title :</b></p>
                          <input type="text" class="mt-1" style="border-radius: 3px;border: 1px solid #7f8c8d;
                          margin-left:57px;width: 282px;"  placeholder="Enter Title"
                          [(ngModel)]="General.EditDataSource.title" name="Title">



                        </div>
                        <div style="display:flex; margin-top: 13px;">
                          <p style="margin-top: 10px;margin-right: 10px;">
                          <b> Columns :</b></p>
                          <input type="number" class="mt-1" style="border-radius: 3px;border: 1px solid #7f8c8d;
                          width: 282px; margin-left: 27px;"  placeholder="Enter Columns"
                          [(ngModel)]="General.EditDataSource.columns" name="Columns">
                        </div>
                        <div style="display:flex; margin-top: 13px;">
                          <p style="margin-top: 10px;margin-right: 10px;">
                          <b> Headers :</b></p>
                          <input type="text" class="mt-1" style="border-radius: 3px;border: 1px solid #7f8c8d;
                          margin-left:31px;width: 282px;"  placeholder="Enter Headers"
                          [(ngModel)]="General.EditDataSource.headers" name="Headers">
                        </div>

                        <div style="display:flex; margin-top: 13px;" *ngIf="!General.EditDataSource.formula">
                          <p style="margin-top: 10px;margin-right: 10px;">
                          <b> Name Range :</b></p>
                          <div class="select mt-1" >
                            <select [(ngModel)]="General.EditDataSource.namedRange">
                              <option *ngFor="let nameRange of General.NameRange"
                                      [ngValue]="nameRange">
                                      {{nameRange}}
                              </option>
                           </select>
                          </div>
                        </div>

                        <div style="display:flex; margin-top: 13px;" *ngIf="General.EditDataSource.formula">
                          <p style="margin-top: 10px;margin-right: 10px;">
                          <b> Formula :</b></p>
                          <input type="text" class="mt-1" style="border-radius: 3px;border: 1px solid #7f8c8d;
                          margin-left:30px;width: 282px;"  placeholder="Enter Formula"
                          [(ngModel)]="General.EditDataSource.formula" name="Headers">
                        </div>
                        <div style="display:flex; margin-top: 13px;">
                          <p style="margin-top: 10px;margin-right: 10px;">
                          <b> Intro :</b></p>
                          <textarea class="form-control" id="exampleFormControlTextarea1" rows="6"  style="margin-left: 50px; width: 500px;"
                          [(ngModel)]="General.EditDataSource.intro"  placeholder="Enter Intro"></textarea>
                        </div>
                        <div  style="display: flex; margin-top: 13px;justify-content: flex-end;">
                        <button id="doAddToBasket" name="doAddToBasket" class=" mt-2 btn_2" type="submit" (click)="UpdateLandingPage(General.EditDataSource)">
                          <span class="arrow_brown">Update Data Source <i class="fas fa-long-arrow-alt-right"></i></span>
                        </button>
                      </div>
                      </div>
                    </div>

                      <!-- Start Table -->
                        <div class="col-lg-12 grid-margin stretch-card" id="{{group.id}}" style="display:none;">
                          <i class="fas fa-times float-right" style="margin-right: 15px; margin-bottom: 7px; margin-top: 10px; font-size: 20px; cursor: pointer; "
                          *ngIf="group.closeGroup" (click)="CloseGroup(group)"></i>
                          <div *ngIf="group.closeGroup">
                            <div *ngFor="let stage of group.stages">
                              <div class="col-lg-12 grid-margin stretch-card">
                                <table class="table table-bordered" [ngClass]="getClassBorderName(stage.title)"
                                    style="border-collapse: collapse;  width: 100%;">
                                      <thead>
                                        <tr style="display: contents;">
                                          <ng-container *ngIf="stage.title =='No Reply'">
                                            <tr><th style="color: #fff; background-color: #fd79a8;">Waitaing For Reply</th></tr>
                                            <tr>
                                              <td style="color:white; text-align:center; background-color: #fd79a8;">Id</td>
                                              <td style="color:white; text-align:center; background-color: #fd79a8;">Organization</td>
                                              <td style="color:white; text-align:center; background-color: #fd79a8;">Actions</td>
                                              <td style="color:white; text-align:center; background-color: #fd79a8;">Latest Date</td>
                                              <td style="color:white; text-align:center; background-color: #fd79a8;">Mail Read</td>
                                              <td style="color:white; text-align:center; background-color: #fd79a8;">Landing Page Load</td>
                                              <td style="color:white; text-align:center; background-color: #fd79a8;">Preview File</td>
                                              <td style="color:white; text-align:center; background-color: #fd79a8;">Downlaod File</td>
                                              <td style="color:white; text-align:center; background-color: #fd79a8;">Received</td>
                                              <td style="color:white; text-align:center; background-color: #fd79a8;">Sent</td>
                                            </tr>
                                            <ng-container *ngFor="let microdeal of stage.microdeals">
                                              <tr id="{{microdeal.id}}" *ngIf="microdeal.inboxNumber > 0">
                                              <td align="center">{{microdeal.id}} </td>
                                              <td align="center"> {{getOrganizationName(microdeal.organization)}} </td>
                                              <td align="center">
                                                <i class="fas fa-inbox ml-2 action-icon" (click)="GetMicroDealInbox(microdeal)"  title="Inbox" >
                                                  <span class='badge badge-warning' id='lblCartCount' *ngIf="microdeal.newMail != 0">
                                                    {{microdeal.newMail}}</span></i>
                                                <i class="fas fa-envelope-open-text ml-2 action-icon" (click)="GetMainInbox(microdeal)" title="Global Inbox"></i>
                                                <i class="fas fa-arrow-right ml-2 movestage-icon " (click)="open(MoveStage , group, microdeal.id )" title="Move Stage"></i>
                                                <i class="fas fa-info ml-2 infoIcon"
                                                  (click)="GetMicroDealInfo(microdeal);open(ContactInfo,microdeal)" title="Info"></i>
                                                  <i class="fab fa-amilia ml-2 assign-icon" (click)="openLgAssign(Assign , microdeal.id )" title="Assign"></i>
                                                  <i class="fas fa-trash-alt  ml-2 assign-icon" (click)="openDeleteGroupModal(DeleteMicroDealModal ,group , microdeal)"></i>
                                                  <!-- <i class="fas fa-calendar-check ml-2 action-icon" (click)="open(ActivityInfo,microdeal)" title="Activity"></i> -->
                                              </td>
                                              <td  align="center">{{microdeal.latestActivity?.dateTime | date }} {{microdeal.latestActivity?.dateTime |
                                                date:'shortTime'}}</td>
                                                <td style="text-align: center; cursor: pointer; font-weight: 600;" (click)="open(ActivityInfoMailRead,microdeal)">{{microdeal.MailRead?.length}}</td>
                                                <td style="text-align: center; cursor: pointer; font-weight: 600;" (click)="open(ActivityInfo,microdeal)">{{microdeal.LandingPageLoad?.length}}</td>
                                                <td style="text-align: center; cursor: pointer; font-weight: 600;" (click)="open(ActivityInfoPreviewFile,microdeal)">{{microdeal.PreviewFile?.length}}</td>
                                                <td style="text-align: center; cursor: pointer; font-weight: 600;" (click)="open(ActivityInfoPreviewFileDownlaodFile,microdeal)">{{microdeal.DownlaodFile?.length}}</td>
                                                <td align="center">{{microdeal.inboxNumber}}</td>
                                                <td align="center">{{microdeal.sent}}</td>
                                              {{scrolltome(microdeal.id)}}
                                              </tr>

                                             <!-- <tr *ngIf="microdeal.toggleInbox == true" style="background-color: #34495e;">
                                              <td [colSpan]="group.stages.length">
                                                <div class="content inbox container-fluid" *ngFor="let email of microdeal.inbox">
                                                <div class="row clearfix">
                                                  <div class="col-md-12 col-lg-12 col-xl-12">
                                                    <ul class="mail_list list-group list-unstyled">
                                                      <li class="list-group-item unread">
                                                        <div class="media" style="cursor: pointer;">
                                                          <div class="media-body">
                                                            <div class="media-heading" (click)="OpenMail(microdeal,email)">
                                                              <span *ngIf="email.direction == 1" class="mr-2"
                                                                style="background-color: #2ecc71; color: #fff; padding: 2px 4px; border-radius: 14px;">
                                                                  <i class="fas fa-envelope-square"></i>
                                                              </span>
                                                              <span *ngIf="email.direction == -1" class="mr-2"
                                                                style="background-color: #b2bec3; color: #fff; padding: 2px 4px; border-radius: 14px;">
                                                              <i class="fas fa-chevron-right"></i>
                                                              </span>
                                                              <span *ngIf="email.direction == 2" class="mr-2"
                                                                style="background-color: #b2bec3; color: #fff; padding: 2px 4px; border-radius: 14px;">
                                                                  <i class="fas fa-angle-double-right"></i>
                                                              </span>
                                                              <a class="m-r-10"> {{email.fromAddress}}</a>
                                                              <small class="float-right text-muted"><time class="hidden-sm-down" datetime="2017"> {{email.date | date }}
                                                              <br>  {{email.date  |  date:'shortTime'}}</time><i
                                                              class="zmdi zmdi-attachment-alt"></i>
                                                              </small>
                                                              <p class="msg">{{email.subject}}</p>
                                                            </div>
                                                          </div>
                                                        </div>
                                                      </li>
                                                    </ul>

                                                    <div *ngIf="email.togglebody" class=" email-body">
                                                      <div [innerHTML]="email.body"  class="mailBody container"></div>
                                                      <button class="btn btn-info mt-3 replayMail ml-auto" (click)="ReplyMail(email)">
                                                            <ng-container >{{email.toggleReply? 'Close' : 'Reply'}}</ng-container></button>


                                                        <div *ngIf="email.toggleReply">
                                                          <div class="mail-container container">
                                                            <div class="modal-body-mail" style="padding:26px;">
                                                              <form>
                                                                <div class="form-group">
                                                                  <label for="recipient-name" class="col-form-label"><b>Email body / Template body:</b></label>

                                                                    <div>
                                                            <ejs-richtexteditor #replyRTE [toolbarSettings]='tools'
                                                            [innerHTML]='email.replyBody' name="replyRTE"> </ejs-richtexteditor>

                                                            <ejs-dialog #templateDialog id="rteDialog" [buttons]='dlgButtons' (overlayClick)="dialogOverlay()"
                                                            [header]='header' [visible]='false' [showCloseIcon]='true' (created)="dialogCreate()" [isModal]='true'>
                                                              <ng-template #content>
                                                              <div id="rteSpecial_char">
                                                                <h3> <b> Contact Data</b></h3>
                                                                <div>

                                                                <div class="btn btn-primary m-1 "title="Firstname"
                                                                (click)="insertPersonalization('#Person.contact.firstName#')">
                                                                #Person.contact.firstName#</div>
                                                                <div class="btn btn-primary m-1" title="Lastname"
                                                                (click)="insertPersonalization('#Person.contact.lastName#')">
                                                                #Person.contact.lastName# </div>
                                                                <div class="btn btn-primary m-1" title="email"  (click)="insertPersonalization('#Person.contact.email#')">
                                                                #Person.contact.email#</div>
                                                                <div class="btn btn-primary m-1"title="phone"
                                                                (click)="insertPersonalization('#Person.contact.phone#')">
                                                                #Person.contact.phone#</div>
                                                                </div>
                                                                <br> <br>
                                                                <h3> <b> Deal Data  </b></h3>
                                                                <div class="btn btn-danger m-1" title="title"(click)="insertPersonalization('#Deal.data.title#')">
                                                                #Deal.data.title# </div>



                                                              </div>
                                                              </ng-template>
                                                            </ejs-dialog>
                                                            <form [formGroup]="uploadFormForReply" class="mt-3">
                                                              <div>
                                                                <input type="file" class="ml-4" name="profile"
                                                                  (change)="UploadFileForReply($event , email)"/>


                                                                  <button class="btn btn-warning" style="margin-left: 23px;
                                                                  padding: 5px 14px; background-color:#fed330"
                                                                  (click)="ShowLibraryFiles=!ShowLibraryFiles">Choose From Library </button>
                                                              </div>
                                                              <div *ngIf="ShowLibraryFiles" style="margin: 20px;">
                                                                <p *ngFor="let file of General.files" >
                                                                  <input (change)="checkIibraryFilesForReply($event ,email)" type="checkbox" id="input{{file.id}}"
                                                                  name="file" class="mr-2 person-name" value="{{file.id}}">
                                                                  {{file.name}} <span style="color: #ffffff; font-weight: 600;"> ({{getCategory(file.categoryId)}}) </span>
                                                                </p>
                                                              </div>

                                                              <div class="files" >
                                                                <p *ngFor="let file of  email.attachements ">
                                                                  {{file}}
                                                                  <button type="button" class="btn btn-danger deleteFile"
                                                                    (click)="deleteFileReply(email ,file)">Delete</button>
                                                                </p>
                                                              </div>
                                                            </form>
                                                            </div>

                                                      <button type="button" class="btn btn-primary float-right" (click)="SendReplyEmail(email)">Send Email</button>

                                                                </div>
                                                              </form>
                                                            </div>
                                                          </div>
                                                        </div>
                                                    </div>
                                                  </div>
                                                </div>
                                              </div>
                                              </td>
                                             </tr> -->

                                             <!-- <tr *ngIf="microdeal.toggleMainInbox == true" style="background-color: #34495e;">
                                               <td [colSpan]="group.stages.length" >

                                              <div class="content inbox container-fluid" *ngFor="let email of microdeal.mainInbox">
                                                <div class="row clearfix">
                                                  <div class="col-md-12 col-lg-12 col-xl-12">
                                                      <ul class="mail_list list-group list-unstyled">
                                                          <li class="list-group-item unread">
                                                              <div class="media" style="cursor: pointer;">
                                                                  <div class="media-body">
                                                                      <div class="media-heading" (click)="OpenMail(microdeal,email)">
                                                                          <span *ngIf="email.direction == 1" class="mr-2" style="background-color: #2ecc71; color: #fff; padding: 2px 4px; border-radius: 14px;">
                                                                              <i class="fas fa-envelope-square"></i>
                                                                          </span>
                                                                          <span *ngIf="email.direction == -1" class="mr-2" style="background-color: #b2bec3; color: #fff; padding: 2px 4px; border-radius: 14px;">
                                                                          <i class="fas fa-chevron-right"></i>
                                                                          </span>
                                                                          <span *ngIf="email.direction == 2" class="mr-2" style="background-color: #b2bec3; color: #fff; padding: 2px 4px; border-radius: 14px;">
                                                                              <i class="fas fa-angle-double-right"></i>
                                                                          </span>

                                                                          <a class="m-r-10"> {{email.fromAddress}}</a>
                                                                          <small class="float-right text-muted"><time class="hidden-sm-down" datetime="2017"> {{email.date | date }}
                                                                          <br>
                                                                          {{email.date  | date:'shortTime' }}</time><i
                                                                          class="zmdi zmdi-attachment-alt"></i>
                                                                          </small> <p class="msg">  {{email.subject}}</p>
                                                                          </div>
                                                                          </div>

                                                                          </div>
                                                                          </li>
                                                                          </ul>

                                                                          <div *ngIf="email.togglebody" class=" email-body">
                                                                            <div [innerHTML]="email.body" class="mailBody container">
                                                                          </div>
                                                                          <button class="btn btn-info mt-3 replayMail ml-auto" (click)="ReplyMail(email)">
                                                                              <ng-container >{{email.toggleReply? 'Close' : 'Reply'}}</ng-container>
                                                                          </button>

                                                                          <div *ngIf="email.toggleReply">
                                                                              <div class="mail-container container">
                                                                                  <div class="modal-body-mail" style="padding:26px;">
                                                                                      <form>
                                                                                          <div class="form-group">
                                                                                              <label for="recipient-name" class="col-form-label">
                                                                                                  <b>Email body / Template body:</b>
                                                                                              </label>

                                                                                              <div>
                                                                                      <ejs-richtexteditor #replyRTE [toolbarSettings]='tools'
                                                                                      [innerHTML]='email.replyBody' name="replyRTE"> </ejs-richtexteditor>

                                                                                      <ejs-dialog #templateDialog id="rteDialog" [buttons]='dlgButtons' (overlayClick)="dialogOverlay()" [header]='header'
                                                                                      [visible]='false' [showCloseIcon]='true' (created)="dialogCreate()" [isModal]='true'>
                                                                                        <ng-template #content>
                                                                                      <div id="rteSpecial_char">
                                                                                        <h3> <b> Contact Data</b></h3>
                                                                                      <div>

                                                                                      <div class="btn btn-primary m-1 "title="Firstname"
                                                                                      (click)="insertPersonalization('#Person.contact.firstName#')">
                                                                                      #Person.contact.firstName#</div>
                                                                                      <div class="btn btn-primary m-1" title="Lastname"
                                                                                      (click)="insertPersonalization('#Person.contact.lastName#')">
                                                                                      #Person.contact.lastName# </div>
                                                                                      <div class="btn btn-primary m-1" title="email"  (click)="insertPersonalization('#Person.contact.email#')">
                                                                                      #Person.contact.email#</div>
                                                                                      <div class="btn btn-primary m-1"title="phone"
                                                                                      (click)="insertPersonalization('#Person.contact.phone#')">
                                                                                      #Person.contact.phone#</div>
                                                                                      </div>
                                                                                      <br> <br>
                                                                                      <h3> <b> Deal Data  </b></h3>
                                                                                      <div class="btn btn-danger m-1" title="title"(click)="insertPersonalization('#Deal.data.title#')">
                                                                                      #Deal.data.title# </div>

                                                                                      <div style="display: inline-block;" *ngFor="let field of Deal.customFields.dealCustomFieldMeta">
                                                                                      <div class="btn btn-danger m-1"title="Parameter.{{field.fieldLabel}}"
                                                                                      (click)="insertPersonalization('#Parameter.'+field.fieldLabel+'#')">
                                                                                      #Parameter.{{field.fieldLabel}}# </div>
                                                                                      </div>

                                                                                        </div>
                                                                                        </ng-template>
                                                                                                  </ejs-dialog>
                                                                                                  <form [formGroup]="uploadFormForReply" class="mt-3">
                                                                                                    <div>
                                                                                                      <input type="file" class="ml-4" name="profile"
                                                                                                        (change)="UploadFileForReply($event , email)"/>
                                                                                                        <button class="btn btn-warning" style="margin-left: 23px;
                                                                                                        padding: 5px 14px; background-color:#fed330"
                                                                                                        (click)="ShowLibraryFiles=!ShowLibraryFiles">Choose From Library </button>
                                                                                                    </div>
                                                                                                    <div *ngIf="ShowLibraryFiles" style="margin: 20px;">
                                                                                                      <p *ngFor="let file of General.files" >
                                                                                                        <input (change)="checkIibraryFilesForReply($event ,email)" type="checkbox" id="input{{file.id}}"
                                                                                                        name="file" class="mr-2 person-name" value="{{file.id}}">
                                                                                                        {{file.name}} <span style="color: #ffffff; font-weight: 600;"> ({{getCategory(file.categoryId)}}) </span>
                                                                                                      </p>
                                                                                                    </div>

                                                                                                    <div class="files" >
                                                                                                      <p *ngFor="let file of  email.attachements ">
                                                                                                        {{file}}
                                                                                                        <button type="button" class="btn btn-danger deleteFile"
                                                                                                          (click)="deleteFileReply(email ,file)">Delete</button>
                                                                                                      </p>
                                                                                                    </div>
                                                                                                  </form>
                                                                                              </div>
                                                                                              <button type="button" class="btn btn-primary float-right" (click)="SendReplyEmail(email)">Send Email</button>
                                                                                          </div>
                                                                                      </form>
                                                                                      <div></div>

                                                                                  </div>
                                                                              </div>

                                                                          </div>
                                                                      </div>
                                                                </div>
                                                              </div>
                                                            </div>


                                              </td>
                                             </tr> -->

                                            </ng-container>
                                          </ng-container>

                                          <th [ngClass]="getClassName(stage.title)"> {{stage.title}}
                                            <i class="fas fa-paper-plane send-icon" title="Send Email" (click)="GetGuid(group, stage,false)"></i>
                                            <i *ngIf="stage.title =='No Reply'" class="fas fa-envelope ml-2 send-icon" (click)="GetGuid(group, stage, true)"
                                             title="Follow Up Email"></i>
                                          </th>
                                        </tr>
                                      </thead>
                                      <tr>
                                        <td style="color:white; text-align:center;" [ngClass]="getClassName(stage.title)">Id</td>
                                        <td style="color:white; text-align:center"  [ngClass]="getClassName(stage.title)">Organization</td>
                                        <td style="color:white; text-align:center"  [ngClass]="getClassName(stage.title)">Actions</td>
                                        <td style="color:white; text-align:center"  [ngClass]="getClassName(stage.title)">Latest Date</td>
                                        <td style="color:white; text-align:center"  [ngClass]="getClassName(stage.title)">Mail Read</td>
                                        <td style="color:white; text-align:center"  [ngClass]="getClassName(stage.title)">Landing Page Load</td>
                                        <td style="color:white; text-align:center"  [ngClass]="getClassName(stage.title)">Preview File</td>
                                        <td style="color:white; text-align:center"  [ngClass]="getClassName(stage.title)">Downlaod File</td>
                                        <td style="color:white; text-align:center"  [ngClass]="getClassName(stage.title)">Received</td>
                                        <td style="color:white; text-align:center"  [ngClass]="getClassName(stage.title)">Sent</td>
                                      </tr>
                                      <tbody>
                                      <!-- Start Send Group -->
                                      <tr *ngIf="stage.toggleSendGroup == true">
                                        <td [colSpan]="group.stages.length + 5" style="padding: 0;">
                                          <div class="modal-body-sendGroup">
                                            <p class="sendgroup-title">Send Email To {{group.title}} Members</p> <br>

                                            <div *ngIf="!PreviewMode">

                                              <div style="margin-bottom: 1rem;" >

                                                <label for="recipient-name" class="col-form-label" style="font-size:15px"> <b>Select Template To Edit:</b></label>
                                                <br>
                                                    <select name="selectTemplate" id="selectTemplate" style="font-size: 14px;
                                                    border-color: #c8c8ca;padding: 0.6rem 1rem;height: inherit!important;line-height: 1.5;color: #495   057;background-color: #fff;border-radius: 0.25rem;"
                                                      (change)="GetTemplateBody()" [(ngModel)]="General.SelectedTemplate.name">
                                                        <option selected value="0">Select Template</option>
                                                        <option *ngFor="let temp of General.Templates" [value]="temp.name">{{temp.name}}</option>
                                                    </select>
                                                  </div>

                                                  <div style="margin-bottom: 1rem;">
                                                    <label for="recipient-name" class="col-form-label" style="font-size:15px"> <b>Sent Emails:</b></label>
                                                    <br>
                                                    <select name="selectSentEmail" id="selectSentEmail" style="font-size: 14px;
                                                    border-color: #c8c8ca;padding: 0.6rem 1rem;height: inherit!important;line-height: 1.5;color: #495   057;background-color: #fff;border-radius: 0.25rem;"
                                                      (change)="selectSentMail(group)" [(ngModel)]="General.SelectedTemplate.id">
                                                        <option selected value="0">Select Email</option>
                                                        <option *ngFor="let mail of group.SentEmails" [value]="mail.id">{{mail.name}}</option>
                                                    </select>
                                                  </div>

                                            </div>
                                            <div class="row">
                                              <div class="col-md-9">
                                                  <div *ngIf="PreviewMode==false">
                                                      <div class="form-group">
                                                        <label for="recipient-name" class="col-form-label" style="font-size:15px"> <b> Email subject / Template name :</b></label>
                                                        <input type="text" class="form-control" [(ngModel)]="General.SelectedTemplate.subject"  name="something">
                                                      </div>
                                                    <form>
                                                      <div class="form-group">
                                                        <label for="recipient-name" class="col-form-label" style="font-size:15px"> <b> Email body / Template body : </b> </label>
                                                        <div>

                                                        <ejs-richtexteditor #templateRTE [toolbarSettings]='tools' [(ngModel)]='General.SelectedTemplate.body'
                                                        name="templateRTE"></ejs-richtexteditor>

                                                        <ejs-dialog #templateDialog id="templateDialog" [buttons]='dlgButtons'
                                                          (overlayClick)="dialogOverlay()" [header]='header' [visible]='false'
                                                          [showCloseIcon]='true'  (created)="dialogCreate()"
                                                          [isModal]='true'>
                                                          <ng-template #content>
                                                            <div id="rteSpecial_char">
                                                              <h3> <b> Contact Data </b> </h3>
                                                              <div>

                                                                <div class="btn btn-primary m-1 " title="Firstname"
                                                                  (click)="insertPersonalization('#Person.contact.firstName#')">
                                                                  #Person.contact.firstName#
                                                                </div>
                                                                <div class="btn btn-primary m-1" title="Lastname"
                                                                  (click)="insertPersonalization('#Person.contact.lastName#')">
                                                                  #Person.contact.lastName#</div>
                                                                <div class="btn btn-primary m-1" title="email"
                                                                  (click)="insertPersonalization('#Person.contact.email#')">
                                                                  #Person.contact.email#</div>
                                                                <div class="btn btn-primary m-1" title="phone"
                                                                  (click)="insertPersonalization('#Person.contact.phone#')">
                                                                  #Person.contact.phone#</div>

                                                              </div>
                                                              <br> <br>
                                                              <h3> <b> Deal Data </b> </h3>
                                                              <div class="btn btn-danger m-1" title="title"
                                                                (click)="insertPersonalization('#Deal.data.title#')">
                                                                #Deal.data.title#</div>
                                                            </div>
                                                          </ng-template>
                                                        </ejs-dialog>
                                                        </div>

                                                      </div>
                                                    </form>

                                                    <form [formGroup]="uploadForm">
                                                      <div>
                                                        <div style="background-color:#a2a2a2; padding:10px ; color:#fff">
                                                        <input (change)="checklandingPage($event)" type="checkbox"
                                                        name="file" class="mr-2 person-name"  > Include Landing Page
                                                      </div>
                                                        <br>   <br>   <br>

                                                        <input type="file"  name="profile"
                                                          (change)="UploadFile($event)"/>
                                                            <button class="btn btn-warning" style="margin-left: 23px;
                                                          padding: 5px 14px; background-color:#fed330"
                                                          (click)="ShowLibraryFiles=!ShowLibraryFiles">Choose From Library </button>

                                                      </div>
                                                      <br> <br>
                                                      <div *ngIf="ShowLibraryFiles" >
                                                        <p *ngFor="let file of General.AllFiles.files" >
                                                          <input (change)="checkIibraryFiles($event)" type="checkbox" id="input{{file.id}}"
                                                          name="file" class="mr-2 person-name" value="{{file.id}}">
                                                          {{file.name}}
                                                        </p>
                                                      </div>
                                                      <div class="files">
                                                        <p *ngFor="let file of General.SelectedTemplate.attachements">
                                                          {{file}}
                                                          <button type="button" class="btn btn-danger deleteFile"
                                                            (click)="deleteFileGroup(file)">Delete</button>
                                                        </p>
                                                      </div>
                                                    </form>

                                                  </div>
                                                  <div class="col-md-9" *ngIf="PreviewMode">
                                                    <div class="form-group">
                                                      <label for="recipient-name" class="col-form-label"> <b> Email subject / Template name :</b></label>
                                                      <input type="text" class="form-control" [value]="General.PreviewTemplate.subject"  name="something">
                                                    </div>

                                                    <blockquote class="blockquote"  >
                                                      <div [innerHTML]="General.PreviewTemplate.body" class="mb-4" id="preview"> </div>
                                                    </blockquote>
                                                  </div>
                                              </div>
                                              <div class="col-md-3">
                                                <div *ngIf="PreviewMode" class="mb-4">
                                                  <button type="button" class="btn btn-primary" (click)="ClosePreview()">Back to compose</button>
                                                </div>

                                                <div>
                                                  <input type="checkbox" [checked]="selectedAll" [(ngModel)]="selectedAll" name="selectAll" (change)="SelectAll($event,stage)">
                                                  <span style="font-weight: bold ; margin-left: 10px;"> Select All</span>
                                                </div>
                                              <br>
                                                  <div *ngFor="let microdeal of stage.microdeals">
                                                    <ng-container *ngIf="!stage.toggleSendGroupFollow || (stage.toggleSendGroupFollow && microdeal.inboxNumber == 0) ">
                                                    <h4>
                                                    <input type="checkbox" class="mr-2 person-name"
                                                    [checked]="microdeal.isSelected" [(ngModel)]="microdeal.isSelected"  (change)="checkOrganization($event, microdeal);"
                                                    value="{{microdeal.organization}}">
                                                      <b>{{GetOrgName(microdeal.organization).name}}</b>
                                                    </h4>
                                                    <ng-container *ngIf="microdeal.contacts">
                                                    <ng-container *ngFor="let Contact of microdeal.contacts.data">
                                                      <div class="select-contact">
                                                          <input type="checkbox" class="mr-2 person-name" name="personid" id="input{{Contact.id}}"
                                                          (change)="CheckContact($event,Contact);checkIfAllSelected()"
                                                          value="{{Contact.id}}"
                                                          [(ngModel)]="Contact.isSelected" >
                                                          <p class="my-auto"> {{Contact.name}}
                                                            <ng-container *ngFor="let item of this.General.sentEmails">
                                                              <i *ngIf="item == Contact.id" class="fas fa-check" style="margin-left: 10px; color:green"></i>
                                                            </ng-container>
                                                            <!-- <a (click)="previewHandleForGroup(Contact.id)" class="preview-anchor" id="{{Contact.id}}">Preview</a>  -->
                                                          </p>
                                                      </div>
                                                      <br>
                                                    </ng-container>
                                                    </ng-container>
                                                    </ng-container>
                                                  </div>
                                              </div>
                                            </div>
                                            <div class="float-right">
                                              <button type="button" style="background-color: #fff; color: #000;border-color: #000"
                                              class="btn btn-primary ml-2" (click)="CloseSendGroup(stage)">Close</button>
                                              <button type="button" *ngIf="PreviewMode == false" class="btn btn-primary ml-2"
                                              style="background-color:#1269db;border-color:#1269db" click="SaveTemplate()">Save Template</button>
                                              <button type="button" style="background-color: #31ce36; border-color:#31ce36"
                                              class="btn btn-primary ml-2" (click)="SendEmailForGroup(group ,stage)">
                                                <ng-container *ngIf="stage.toggleSendGroupFollow">
                                                  Send Follow Up Email
                                                </ng-container>
                                                <ng-container *ngIf="!stage.toggleSendGroupFollow">
                                                  Send Email
                                                </ng-container>
                                              </button>
                                            </div>
                                          </div>
                                        </td>
                                      </tr>
                                      <!-- End Send Group -->
                                        <ng-container *ngIf="stage.microdeals.length > 0">
                                          <ng-container *ngFor="let microdeal of stage.microdeals">
                                            <tr id="{{microdeal.id}}" *ngIf="stage.title =='No Reply' && microdeal.inboxNumber == 0">
                                              <td align="center">  {{microdeal.id}}</td>
                                              <td align="center"> {{microdeal.organization}} {{getOrganizationName(microdeal.organization)}} </td>
                                              <td align="center">
                                                <i class="fas fa-inbox ml-2 action-icon" (click)="GetMicroDealInbox(microdeal)"  title="Inbox" >
                                                  <span class='badge badge-warning' id='lblCartCount' *ngIf="microdeal.newMail != 0">
                                                    {{microdeal.newMail}}</span></i>
                                                <i class="fas fa-envelope-open-text ml-2 action-icon" (click)="GetMainInbox(microdeal)" title="Global Inbox"></i>
                                                <i class="fas fa-arrow-right ml-2 movestage-icon " (click)="open(MoveStage , group, microdeal.id )" title="Move Stage"></i>
                                                <i class="fas fa-info ml-2 action-icon"
                                                (click)="GetMicroDealInfo(microdeal);open(ContactInfo,microdeal)" title="Info"></i>
                                                <i class="fab fa-amilia ml-2 action-icon" (click)="openLgAssign(Assign , microdeal.id )" title="Assign"></i>
                                                <i class="fas fa-trash-alt ml-2 action-icon" title="Delete MicroDeal" (click)="openDeleteGroupModal(DeleteMicroDealModal ,group , microdeal)"></i>
                                                  <!-- <i class="fas fa-calendar-check ml-2 action-icon" (click)="open(ActivityInfo,microdeal)" title="Activity"></i> -->
                                              </td>
                                              <td  align="center">{{microdeal.latestActivity?.dateTime | date }} {{microdeal.latestActivity?.dateTime |
                                                date:'shortTime'}}</td>
                                                <td style="text-align: center; cursor: pointer; font-weight: 600;" (click)="open(ActivityInfoMailRead,microdeal)">{{microdeal.MailRead?.length}}</td>
                                                <td style="text-align: center; cursor: pointer; font-weight: 600;" (click)="open(ActivityInfo,microdeal)">{{microdeal.LandingPageLoad?.length}}</td>
                                                <td style="text-align: center; cursor: pointer; font-weight: 600;" (click)="open(ActivityInfoPreviewFile,microdeal)">{{microdeal.PreviewFile?.length}}</td>
                                                <td style="text-align: center; cursor: pointer; font-weight: 600;" (click)="open(ActivityInfoPreviewFileDownlaodFile,microdeal)">{{microdeal.DownlaodFile?.length}}</td>
                                              <td  align="center">
                                                {{microdeal.inboxNumber}}
                                             </td>
                                              <td  align="center">{{microdeal.sent}}</td>
                                              {{scrolltome(microdeal.id)}}
                                            </tr>
                                              <!-- Main Table -->
                                            <tr id="{{microdeal.id}}" *ngIf="stage.title !='No Reply'">
                                              <td align="center">  {{microdeal.id}} </td>
                                              <td align="center"> {{getOrganizationName(microdeal.organization)}} </td>
                                              <td align="center">
                                                <i class="fas fa-inbox ml-2 action-icon" (click)="GetMicroDealInbox(microdeal)"  title="Inbox" >
                                                  <span class='badge badge-warning' id='lblCartCount' *ngIf="microdeal.newMail != 0">
                                                    {{microdeal.newMail}}
                                                  </span>
                                                  </i>
                                                <i class="fas fa-envelope-open-text ml-2 action-icon" (click)="GetMainInbox(microdeal)" title="Global Inbox"></i>
                                                <i class="fas fa-arrow-right ml-2 movestage-icon " (click)="open(MoveStage , group, microdeal.id )" title="Move Stage"></i>
                                                <i class="fas fa-info ml-2 action-icon"
                                                  (click)="GetMicroDealInfo(microdeal);open(ContactInfo,microdeal)" title="Info"></i>
                                                  <i class="fab fa-amilia ml-2 action-icon" (click)="openLgAssign(Assign , microdeal.id )" title="Assign"></i>
                                                  <i class="fas fa-trash-alt ml-2 action-icon" title="Delete MicroDeal" (click)="openDeleteGroupModal(DeleteMicroDealModal ,group , microdeal)"></i>
                                                  <!-- <i class="fas fa-calendar-check ml-2 action-icon" (click)="open(ActivityInfo,microdeal)" title="Activity"></i> -->
                                              </td>
                                              <td align="center">{{microdeal.latestActivity?.dateTime | date }} {{microdeal.latestActivity?.dateTime |
                                                date:'shortTime'}}</td>
                                                <td style="text-align: center; cursor: pointer; font-weight: 600;" (click)="open(ActivityInfoMailRead,microdeal)">{{microdeal.MailRead?.length}}</td>
                                                <td style="text-align: center; cursor: pointer; font-weight: 600;" (click)="open(ActivityInfo,microdeal)">{{microdeal.LandingPageLoad?.length}}</td>
                                                <td style="text-align: center; cursor: pointer; font-weight: 600;" (click)="open(ActivityInfoPreviewFile,microdeal)">{{microdeal.PreviewFile?.length}}</td>
                                                <td style="text-align: center; cursor: pointer; font-weight: 600;" (click)="open(ActivityInfoPreviewFileDownlaodFile,microdeal)">{{microdeal.DownlaodFile?.length}}</td>
                                              <td align="center">

                                                {{microdeal.inboxNumber}}
                                              </td>
                                              <td align="center">{{microdeal.sent}}</td>
                                              {{scrolltome(microdeal.id)}}
                                            </tr>

                                            <tr *ngIf="microdeal.toggleInbox == true" style="background-color: #34495e;">
                                              <td [colSpan]="group.stages.length">
                                              <ul ngbNav #nav="ngbNav" [(activeId)]="active" class="nav-tabs" style="background-color: #25CCF7; padding:5px; border-radius: 5px;">
                                                <li [ngbNavItem]="person.id[0]" *ngFor="let person of General.persons.data">
                                                  <a ngbNavLink style="color: black; border-radius: 5px; margin-right: 2px; font-weight: 500;">{{person.name}}
                                                    <!-- <span class='badge badge-warning' id='lblCartCount' *ngIf="microdeal.newMail != 0">
                                                    {{microdeal.newMail}}</span> -->
                                                  </a>
                                                  <ng-template ngbNavContent >
                                                      <div class="content inbox container-fluid" *ngFor="let email of getMailsForContact(person.id , microdeal)">
                                                      <div class="row clearfix">
                                                        <div class="col-md-12" >
                                                          <ul class="mail_list list-group list-unstyled">
                                                            <li class="list-group-item unread">
                                                              <div class="media" style="cursor: pointer;">
                                                                <div class="media-body">
                                                                  <div class="media-heading" (click)="OpenMail(microdeal,email)">
                                                                    <span *ngIf="email.direction == 1" class="mr-2"
                                                                      style="background-color: #2ecc71; color: #fff; padding: 2px 4px; border-radius: 14px;">
                                                                        <i class="fas fa-envelope-square"></i>
                                                                    </span>
                                                                    <span *ngIf="email.direction == -1" class="mr-2"
                                                                      style="background-color: #b2bec3; color: #fff; padding: 2px 4px; border-radius: 14px;">
                                                                    <i class="fas fa-chevron-right"></i>
                                                                    </span>
                                                                    <span *ngIf="email.direction == 2" class="mr-2"
                                                                      style="background-color: #b2bec3; color: #fff; padding: 2px 4px; border-radius: 14px;">
                                                                        <i class="fas fa-angle-double-right"></i>
                                                                    </span>
                                                                    <a class="m-r-10"> {{email.fromAddress}}</a>
                                                                    <small class="float-right text-muted"><time class="hidden-sm-down" datetime="2017"> {{email.date | date }}
                                                                    <br>  {{email.date  |  date:'shortTime'}}</time><i
                                                                    class="zmdi zmdi-attachment-alt"></i>
                                                                    </small>
                                                                    <p class="msg" style="color:#000">{{email.subject}}</p>
                                                                  </div>
                                                                </div>
                                                              </div>
                                                            </li>
                                                          </ul>

                                                          <div *ngIf="email.togglebody" class=" email-body">
                                                            <div [innerHTML]="email.body"  class="mailBody container" style="color:#000"></div>
                                                            <button class="btn btn-info mt-3 replayMail ml-auto" (click)="ReplyMail(email)">
                                                                  <ng-container >{{email.toggleReply? 'Close' : 'Reply'}}</ng-container></button>

                                                              <div *ngIf="email.toggleReply">
                                                                <div class="mail-container container">
                                                                  <div class="modal-body-mail" style="padding:26px;">
                                                                    <form>
                                                                      <div class="form-group">
                                                                        <label for="recipient-name" class="col-form-label"><b>Email body / Template body:</b></label>

                                                                          <div>
                                                                  <ejs-richtexteditor #replyRTE [toolbarSettings]='tools'
                                                                  [innerHTML]='email.replyBody' name="replyRTE"> </ejs-richtexteditor>

                                                                  <ejs-dialog #templateDialog id="rteDialog" [buttons]='dlgButtons' (overlayClick)="dialogOverlay()"
                                                                  [header]='header' [visible]='false' [showCloseIcon]='true' (created)="dialogCreate()" [isModal]='true'>
                                                                    <ng-template #content>
                                                                    <div id="rteSpecial_char">
                                                                      <h3> <b> Contact Data</b></h3>
                                                                      <div>

                                                                      <div class="btn btn-primary m-1 "title="Firstname"
                                                                      (click)="insertPersonalization('#Person.contact.firstName#')">
                                                                      #Person.contact.firstName#</div>
                                                                      <div class="btn btn-primary m-1" title="Lastname"
                                                                      (click)="insertPersonalization('#Person.contact.lastName#')">
                                                                      #Person.contact.lastName# </div>
                                                                      <div class="btn btn-primary m-1" title="email"  (click)="insertPersonalization('#Person.contact.email#')">
                                                                      #Person.contact.email#</div>
                                                                      <div class="btn btn-primary m-1"title="phone"
                                                                      (click)="insertPersonalization('#Person.contact.phone#')">
                                                                      #Person.contact.phone#</div>
                                                                      </div>
                                                                      <br> <br>
                                                                      <h3> <b> Deal Data  </b></h3>
                                                                      <div class="btn btn-danger m-1" title="title"(click)="insertPersonalization('#Deal.data.title#')">
                                                                      #Deal.data.title# </div>


                                                                    </div>
                                                                    </ng-template>
                                                                  </ejs-dialog>
                                                                  <form [formGroup]="uploadFormForReply" class="mt-3">
                                                                    <div>
                                                                      <input type="file" class="ml-4" name="profile"
                                                                        (change)="UploadFileForReply($event , email)"/>

                                                                        <button class="btn btn-warning" style="margin-left: 23px;
                                                                          padding: 5px 14px; background-color:#fed330"
                                                                        (click)="ShowLibraryFiles=!ShowLibraryFiles">Choose From Library </button>
                                                                    </div>
                                                                    <div *ngIf="ShowLibraryFiles" style="margin: 20px;">
                                                                      <p *ngFor="let file of General.AllFiles.files" >
                                                                        <input (change)="checkIibraryFilesForReply($event ,email)" type="checkbox" id="input{{file.id}}"
                                                                        name="file" class="mr-2 person-name" value="{{file.id}}">
                                                                        {{file.name}}

                                                                      </p>
                                                                    </div>

                                                                    <div class="files" >
                                                                      <p *ngFor="let file of  email.attachements ">
                                                                        {{file}}
                                                                        <button type="button" class="btn btn-danger deleteFile"
                                                                          (click)="deleteFileReply(email ,file)">Delete</button>
                                                                      </p>
                                                                    </div>
                                                                  </form>
                                                                  </div>

                                                            <button type="button" class="btn btn-primary float-right" (click)="SendReplyEmail(email, stage)">Send Email</button>

                                                                      </div>
                                                                    </form>
                                                                  </div>
                                                                </div>
                                                              </div>
                                                          </div>
                                                        </div>

                                                      </div>
                                                    </div>


                                                  </ng-template>
                                                </li>

                                              </ul>

                                              <div [ngbNavOutlet]="nav" class="mt-2"></div>


                                            <br>

                                          </td>
                                              <!-- <td [colSpan]="group.stages.length">
                                                <div class="content inbox container-fluid" *ngFor="let email of microdeal.inbox">
                                                <div class="row clearfix">
                                                  <div class="col-md-12 col-lg-12 col-xl-12">
                                                    <ul class="mail_list list-group list-unstyled">
                                                      <li class="list-group-item unread">
                                                        <div class="media" style="cursor: pointer;">
                                                          <div class="media-body">
                                                            <div class="media-heading" (click)="OpenMail(microdeal,email)">
                                                              <span *ngIf="email.direction == 1" class="mr-2"
                                                                style="background-color: #2ecc71; color: #fff; padding: 2px 4px; border-radius: 14px;">
                                                                  <i class="fas fa-envelope-square"></i>
                                                              </span>
                                                              <span *ngIf="email.direction == -1" class="mr-2"
                                                                style="background-color: #b2bec3; color: #fff; padding: 2px 4px; border-radius: 14px;">
                                                              <i class="fas fa-chevron-right"></i>
                                                              </span>
                                                              <span *ngIf="email.direction == 2" class="mr-2"
                                                                style="background-color: #b2bec3; color: #fff; padding: 2px 4px; border-radius: 14px;">
                                                                  <i class="fas fa-angle-double-right"></i>
                                                              </span>
                                                              <a class="m-r-10"> {{email.fromAddress}}</a>
                                                              <small class="float-right text-muted"><time class="hidden-sm-down" datetime="2017"> {{email.date | date }}
                                                              <br>  {{email.date  |  date:'shortTime'}}</time><i
                                                              class="zmdi zmdi-attachment-alt"></i>
                                                              </small>
                                                              <p class="msg">{{email.subject}}</p>
                                                            </div>
                                                          </div>
                                                        </div>
                                                      </li>
                                                    </ul>

                                                    <div *ngIf="email.togglebody" class=" email-body">
                                                      <div [innerHTML]="email.body"  class="mailBody container"></div>
                                                      <button class="btn btn-info mt-3 replayMail ml-auto" (click)="ReplyMail(email)">
                                                            <ng-container >{{email.toggleReply? 'Close' : 'Reply'}}</ng-container></button>


                                                        <div *ngIf="email.toggleReply">
                                                          <div class="mail-container container">
                                                            <div class="modal-body-mail" style="padding:26px;">
                                                              <form>
                                                                <div class="form-group">
                                                                  <label for="recipient-name" class="col-form-label"><b>Email body / Template body:</b></label>

                                                                    <div>
                                                            <ejs-richtexteditor #replyRTE [toolbarSettings]='tools'
                                                            [innerHTML]='email.replyBody' name="replyRTE"> </ejs-richtexteditor>

                                                            <ejs-dialog #templateDialog id="rteDialog" [buttons]='dlgButtons' (overlayClick)="dialogOverlay()"
                                                            [header]='header' [visible]='false' [showCloseIcon]='true' (created)="dialogCreate()" [isModal]='true'>
                                                              <ng-template #content>
                                                              <div id="rteSpecial_char">
                                                                <h3> <b> Contact Data</b></h3>
                                                                <div>

                                                                <div class="btn btn-primary m-1 "title="Firstname"
                                                                (click)="insertPersonalization('#Person.contact.firstName#')">
                                                                #Person.contact.firstName#</div>
                                                                <div class="btn btn-primary m-1" title="Lastname"
                                                                (click)="insertPersonalization('#Person.contact.lastName#')">
                                                                #Person.contact.lastName# </div>
                                                                <div class="btn btn-primary m-1" title="email"  (click)="insertPersonalization('#Person.contact.email#')">
                                                                #Person.contact.email#</div>
                                                                <div class="btn btn-primary m-1"title="phone"
                                                                (click)="insertPersonalization('#Person.contact.phone#')">
                                                                #Person.contact.phone#</div>
                                                                </div>
                                                                <br> <br>
                                                                <h3> <b> Deal Data  </b></h3>
                                                                <div class="btn btn-danger m-1" title="title"(click)="insertPersonalization('#Deal.data.title#')">
                                                                #Deal.data.title# </div>


                                                              </div>
                                                              </ng-template>
                                                            </ejs-dialog>
                                                            <form [formGroup]="uploadFormForReply" class="mt-3">
                                                              <div>
                                                                <input type="file" class="ml-4" name="profile"
                                                                  (change)="UploadFileForReply($event , email)"/>



                                                                  <button class="btn btn-warning" style="margin-left: 23px;
                                                                  padding: 5px 14px; background-color:#fed330"
                                                                  (click)="ShowLibraryFiles=!ShowLibraryFiles">Choose From Library </button>
                                                              </div>
                                                              <div *ngIf="ShowLibraryFiles" style="margin: 20px;">
                                                                <p *ngFor="let file of General.files" >
                                                                  <input (change)="checkIibraryFilesForReply($event ,email)" type="checkbox" id="input{{file.id}}"
                                                                  name="file" class="mr-2 person-name" value="{{file.id}}">
                                                                  {{file.name}} <span style="color: #ffffff; font-weight: 600;"> ({{getCategory(file.categoryId)}}) </span>
                                                                </p>
                                                              </div>

                                                              <div class="files" >
                                                                <p *ngFor="let file of  email.attachements ">
                                                                  {{file}}
                                                                  <button type="button" class="btn btn-danger deleteFile"
                                                                    (click)="deleteFileReply(email ,file)">Delete</button>
                                                                </p>
                                                              </div>
                                                            </form>
                                                            </div>

                                                      <button type="button" class="btn btn-primary float-right" (click)="SendReplyEmail(email)">Send Email</button>

                                                                </div>
                                                              </form>
                                                            </div>
                                                          </div>
                                                        </div>
                                                    </div>
                                                  </div>
                                                </div>
                                              </div>
                                              </td> -->
                                            </tr>

                                            <tr *ngIf="microdeal.toggleMainInbox == true" style="background-color: #34495e;">
                                              <td [colSpan]="group.stages.length">
                                                <ul ngbNav #nav="ngbNav" [(activeId)]="active" class="nav-tabs"style="background-color: #25CCF7; padding:5px; border-radius: 5px;">
                                                  <li [ngbNavItem]="person.id[0]" *ngFor="let person of General.persons.data">
                                                    <a ngbNavLink style="color: black; border-radius: 5px; margin-right: 2px; font-weight: 500;">{{person.name}}</a>
                                                    <ng-template ngbNavContent >
                                                        <div class="content inbox container-fluid" *ngFor="let email of getAllMailsForContact(person.id , microdeal)">
                                                        <div class="row clearfix">
                                                          <div class="col-md-12">
                                                            <ul class="mail_list list-group list-unstyled">
                                                              <li class="list-group-item unread">
                                                                <div class="media" style="cursor: pointer;">
                                                                  <div class="media-body">
                                                                    <div class="media-heading" (click)="OpenMail(microdeal,email)">
                                                                      <span *ngIf="email.direction == 1" class="mr-2"
                                                                        style="background-color: #2ecc71; color: #fff; padding: 2px 4px; border-radius: 14px;">
                                                                          <i class="fas fa-envelope-square"></i>
                                                                      </span>
                                                                      <span *ngIf="email.direction == -1" class="mr-2"
                                                                        style="background-color: #b2bec3; color: #fff; padding: 2px 4px; border-radius: 14px;">
                                                                      <i class="fas fa-chevron-right"></i>
                                                                      </span>
                                                                      <span *ngIf="email.direction == 2" class="mr-2"
                                                                        style="background-color: #b2bec3; color: #fff; padding: 2px 4px; border-radius: 14px;">
                                                                          <i class="fas fa-angle-double-right"></i>
                                                                      </span>
                                                                      <a class="m-r-10"> {{email.fromAddress}}</a>
                                                                      <small class="float-right text-muted"><time class="hidden-sm-down" datetime="2017"> {{email.date | date }}
                                                                      <br>  {{email.date  |  date:'shortTime'}}</time><i
                                                                      class="zmdi zmdi-attachment-alt"></i>
                                                                      </small>
                                                                      <p class="msg">{{email.subject}}</p>
                                                                    </div>
                                                                  </div>
                                                                </div>
                                                              </li>
                                                            </ul>

                                                            <div *ngIf="email.togglebody" class=" email-body">
                                                              <div [innerHTML]="email.body"  class="mailBody container"></div>
                                                              <button class="btn btn-info mt-3 replayMail ml-auto" (click)="ReplyMail(email)">
                                                                    <ng-container >{{email.toggleReply? 'Close' : 'Reply'}}</ng-container></button>


                                                                <div *ngIf="email.toggleReply">
                                                                  <div class="mail-container container">
                                                                    <div class="modal-body-mail" style="padding:26px;">
                                                                      <form>
                                                                        <div class="form-group">
                                                                          <label for="recipient-name" class="col-form-label"><b>Email body / Template body:</b></label>

                                                                            <div>
                                                                    <ejs-richtexteditor #replyRTE [toolbarSettings]='tools'
                                                                    [innerHTML]='email.replyBody' name="replyRTE"> </ejs-richtexteditor>

                                                                    <ejs-dialog #templateDialog id="rteDialog" [buttons]='dlgButtons' (overlayClick)="dialogOverlay()"
                                                                    [header]='header' [visible]='false' [showCloseIcon]='true' (created)="dialogCreate()" [isModal]='true'>
                                                                      <ng-template #content>
                                                                      <div id="rteSpecial_char">
                                                                        <h3> <b> Contact Data</b></h3>
                                                                        <div>

                                                                        <div class="btn btn-primary m-1 "title="Firstname"
                                                                        (click)="insertPersonalization('#Person.contact.firstName#')">
                                                                        #Person.contact.firstName#</div>
                                                                        <div class="btn btn-primary m-1" title="Lastname"
                                                                        (click)="insertPersonalization('#Person.contact.lastName#')">
                                                                        #Person.contact.lastName# </div>
                                                                        <div class="btn btn-primary m-1" title="email"  (click)="insertPersonalization('#Person.contact.email#')">
                                                                        #Person.contact.email#</div>
                                                                        <div class="btn btn-primary m-1"title="phone"
                                                                        (click)="insertPersonalization('#Person.contact.phone#')">
                                                                        #Person.contact.phone#</div>
                                                                        </div>
                                                                        <br> <br>
                                                                        <h3> <b> Deal Data  </b></h3>
                                                                        <div class="btn btn-danger m-1" title="title"(click)="insertPersonalization('#Deal.data.title#')">
                                                                        #Deal.data.title# </div>


                                                                      </div>
                                                                      </ng-template>
                                                                    </ejs-dialog>
                                                                    <form [formGroup]="uploadFormForReply" class="mt-3">
                                                                      <div>
                                                                        <input type="file" class="ml-4" name="profile"
                                                                          (change)="UploadFileForReply($event , email)"/>



                                                                          <button class="btn btn-warning" style="margin-left: 23px;
                                                                          padding: 5px 14px; background-color:#fed330"
                                                                          (click)="ShowLibraryFiles=!ShowLibraryFiles">Choose From Library </button>
                                                                      </div>
                                                                      <div *ngIf="ShowLibraryFiles" style="margin: 20px;">
                                                                        <p *ngFor="let file of General.AllFiles.files" >
                                                                          <input (change)="checkIibraryFilesForReply($event ,email)" type="checkbox" id="input{{file.id}}"
                                                                          name="file" class="mr-2 person-name" value="{{file.id}}">
                                                                          {{file.name}}
                                                                        </p>
                                                                      </div>

                                                                      <div class="files" >
                                                                        <p *ngFor="let file of  email.attachements ">
                                                                          {{file}}
                                                                          <button type="button" class="btn btn-danger deleteFile"
                                                                            (click)="deleteFileReply(email ,file)">Delete</button>
                                                                        </p>
                                                                      </div>
                                                                    </form>
                                                                    </div>

                                                              <button type="button" class="btn btn-primary float-right" (click)="SendReplyEmail(email, stage)">Send Email</button>

                                                                        </div>
                                                                      </form>
                                                                    </div>
                                                                  </div>
                                                                </div>
                                                            </div>
                                                          </div>
                                                        </div>
                                                      </div>


                                                    </ng-template>
                                                  </li>

                                                </ul>

                                                <div [ngbNavOutlet]="nav" class="mt-2"></div>


                                              <br>

                                            </td>
                                            <!-- <td [colSpan]="group.stages.length" >
                                              <div class="content inbox container-fluid" *ngFor="let email of microdeal.mainInbox">
                                                <div class="row clearfix">
                                                  <div class="col-md-12 col-lg-12 col-xl-12">
                                                      <ul class="mail_list list-group list-unstyled">
                                                          <li class="list-group-item unread">
                                                              <div class="media" style="cursor: pointer;">
                                                                  <div class="media-body">
                                                                      <div class="media-heading" (click)="OpenMail(microdeal,email)">
                                                                          <span *ngIf="email.direction == 1" class="mr-2" style="background-color: #2ecc71; color: #fff; padding: 2px 4px; border-radius: 14px;">
                                                                              <i class="fas fa-envelope-square"></i>
                                                                          </span>
                                                                          <span *ngIf="email.direction == -1" class="mr-2" style="background-color: #b2bec3; color: #fff; padding: 2px 4px; border-radius: 14px;">
                                                                          <i class="fas fa-chevron-right"></i>
                                                                          </span>
                                                                          <span *ngIf="email.direction == 2" class="mr-2" style="background-color: #b2bec3; color: #fff; padding: 2px 4px; border-radius: 14px;">
                                                                              <i class="fas fa-angle-double-right"></i>
                                                                          </span>

                                                                          <a class="m-r-10"> {{email.fromAddress}}</a>
                                                                          <small class="float-right text-muted"><time class="hidden-sm-down" datetime="2017"> {{email.date | date }}
                                                                          <br>
                                                                          {{email.date  | date:'shortTime' }}</time><i
                                                                          class="zmdi zmdi-attachment-alt"></i>
                                                                          </small> <p class="msg">  {{email.subject}}</p>
                                                                          </div>
                                                                          </div>

                                                                          </div>
                                                                          </li>
                                                                          </ul>

                                                                          <div *ngIf="email.togglebody" class=" email-body">
                                                                            <div [innerHTML]="email.body" class="mailBody container">
                                                                          </div>
                                                                          <button class="btn btn-info mt-3 replayMail ml-auto" (click)="ReplyMail(email)">
                                                                              <ng-container >{{email.toggleReply? 'Close' : 'Reply'}}</ng-container>
                                                                          </button>

                                                                          <div *ngIf="email.toggleReply">
                                                                              <div class="mail-container container">
                                                                                  <div class="modal-body-mail" style="padding:26px;">
                                                                                      <form>
                                                                                          <div class="form-group">
                                                                                              <label for="recipient-name" class="col-form-label">
                                                                                                  <b>Email body / Template body:</b>
                                                                                              </label>

                                                                                              <div>
                                                                                      <ejs-richtexteditor #replyRTE [toolbarSettings]='tools'
                                                                                      [innerHTML]='email.replyBody' name="replyRTE"> </ejs-richtexteditor>

                                                                                      <ejs-dialog #templateDialog id="rteDialog" [buttons]='dlgButtons' (overlayClick)="dialogOverlay()" [header]='header'
                                                                                      [visible]='false' [showCloseIcon]='true' (created)="dialogCreate()" [isModal]='true'>
                                                                                        <ng-template #content>
                                                                                      <div id="rteSpecial_char">
                                                                                        <h3> <b> Contact Data</b></h3>
                                                                                      <div>

                                                                                      <div class="btn btn-primary m-1 "title="Firstname"
                                                                                      (click)="insertPersonalization('#Person.contact.firstName#')">
                                                                                      #Person.contact.firstName#</div>
                                                                                      <div class="btn btn-primary m-1" title="Lastname"
                                                                                      (click)="insertPersonalization('#Person.contact.lastName#')">
                                                                                      #Person.contact.lastName# </div>
                                                                                      <div class="btn btn-primary m-1" title="email"  (click)="insertPersonalization('#Person.contact.email#')">
                                                                                      #Person.contact.email#</div>
                                                                                      <div class="btn btn-primary m-1"title="phone"
                                                                                      (click)="insertPersonalization('#Person.contact.phone#')">
                                                                                      #Person.contact.phone#</div>
                                                                                      </div>
                                                                                      <br> <br>
                                                                                      <h3> <b> Deal Data  </b></h3>
                                                                                      <div class="btn btn-danger m-1" title="title"(click)="insertPersonalization('#Deal.data.title#')">
                                                                                      #Deal.data.title# </div>

                                                                                      <div style="display: inline-block;" *ngFor="let field of Deal.customFields.dealCustomFieldMeta">
                                                                                      <div class="btn btn-danger m-1"title="Parameter.{{field.fieldLabel}}"
                                                                                      (click)="insertPersonalization('#Parameter.'+field.fieldLabel+'#')">
                                                                                      #Parameter.{{field.fieldLabel}}# </div>
                                                                                      </div>

                                                                                        </div>
                                                                                        </ng-template>
                                                                                                  </ejs-dialog>
                                                                                                  <form [formGroup]="uploadFormForReply" class="mt-3">
                                                                                                    <div>
                                                                                                      <input type="file" class="ml-4" name="profile"
                                                                                                        (change)="UploadFileForReply($event , email)"/>
                                                                                                        <button class="btn btn-warning" style="margin-left: 23px;
                                                                                                        padding: 5px 14px; background-color:#fed330"
                                                                                                        (click)="ShowLibraryFiles=!ShowLibraryFiles">Choose From Library </button>
                                                                                                    </div>
                                                                                                    <div *ngIf="ShowLibraryFiles" style="margin: 20px;">
                                                                                                      <p *ngFor="let file of General.files" >
                                                                                                        <input (change)="checkIibraryFilesForReply($event ,email)" type="checkbox" id="input{{file.id}}"
                                                                                                        name="file" class="mr-2 person-name" value="{{file.id}}">
                                                                                                        {{file.name}} <span style="color: #ffffff; font-weight: 600;"> ({{getCategory(file.categoryId)}}) </span>
                                                                                                      </p>
                                                                                                    </div>

                                                                                                    <div class="files" >
                                                                                                      <p *ngFor="let file of  email.attachements ">
                                                                                                        {{file}}
                                                                                                        <button type="button" class="btn btn-danger deleteFile"
                                                                                                          (click)="deleteFileReply(email ,file)">Delete</button>
                                                                                                      </p>
                                                                                                    </div>
                                                                                                  </form>
                                                                                              </div>
                                                                                              <button type="button" class="btn btn-primary float-right" (click)="SendReplyEmail(email)">Send Email</button>
                                                                                          </div>
                                                                                      </form>
                                                                                      <div></div>

                                                                                  </div>
                                                                              </div>

                                                                          </div>
                                                                      </div>
                                                  </div>
                                                </div>
                                              </div>


                                            </td> -->
                                            </tr>

                                          </ng-container>
                                        </ng-container>

                                        <ng-container *ngIf="stage.microdeals.length==0" >
                                          <tr>
                                            <td  align="center" colspan="7">No Records</td>
                                          </tr>
                                        </ng-container>
                                      </tbody>
                                </table>
                                <br/><br/>
                              </div>
                            </div>
                          </div>
                        </div>
                        <!-- End Table -->
                      </div>
                    </div>
                </div>
              </td>
              </tr>
            </ng-container>
          </tbody>
        </table>
      </div>

  </div>
</div>
<!-- End Scenario -->
</div>

 </div>

<!--End Intro -->












<!-- Modals -->


<!-- Templates Modal -->
<!-- <ng-template #Templates let-modal>
  <div class="modal-body-template">
    <p><b>Select Template To Edit:</b></p>
      <div >
          <select name="slctTemp" id="slct" (change)="GetTemplateBody()" [(ngModel)]="General.SelectedTemplate.name">
              <option selected value="0">Select Template</option>
              <option *ngFor="let temp of General.Templates" [ngValue]="temp.name">{{temp.name}}</option>
          </select>
      </div>
      <form>
          <div class="form-group">
              <label for="recipient-name" class="col-form-label"> <b> Email subject /
                      Template name :</b></label>
              <input type="text" class="form-control" [(ngModel)]="General.SelectedTemplate.name" name="tmeplateName">
          </div>
          <div class="form-group">
              <label for="recipient-name" class="col-form-label"> <b> Email body / Template
                      body : </b> </label>
              <ejs-richtexteditor #templateRTE [toolbarSettings]='tools' [(ngModel)]='General.SelectedTemplate.body'
                  name="templateRTE"></ejs-richtexteditor>
                  <ejs-dialog #templateDialog id="Dialog" [buttons]='dlgButtons'
                  (overlayClick)="dialogOverlay()" [header]='header' [visible]='false'
                  [showCloseIcon]='true'  (created)="dialogCreate()"
                  [isModal]='true'>
                  <ng-template #content>
                    <div id="rteSpecial_char">
                      <h3> <b> Contact Data </b> </h3>
                      <div>

                        <div class="btn btn-primary m-1 " title="Firstname"
                          (click)="insertPersonalization('#Person.contact.firstName#')">
                          #Person.contact.firstName#
                        </div>
                        <div class="btn btn-primary m-1" title="Lastname"
                          (click)="insertPersonalization('#Person.contact.lastName#')">
                          #Person.contact.lastName#</div>
                        <div class="btn btn-primary m-1" title="email"
                          (click)="insertPersonalization('#Person.contact.email#')">
                          #Person.contact.email#</div>
                        <div class="btn btn-primary m-1" title="phone"
                          (click)="insertPersonalization('#Person.contact.phone#')">
                          #Person.contact.phone#</div>

                      </div>
                      <br> <br>
                      <h3> <b> Deal Data </b> </h3>
                      <div class="btn btn-danger m-1" title="title"
                        (click)="insertPersonalization('#Deal.data.title#')">
                        #Deal.data.title#</div>

                      <div style="display: inline-block;"
                        *ngFor="let Field of Deal.customFields.dealCustomFieldMeta;">
                        <div class="btn btn-danger m-1"
                          title="Parameter.{{Field.fieldLabel}}"
                          (click)="insertPersonalization('#Parameter.'+Field.fieldLabel+'#')">
                          #Parameter.{{Field.fieldLabel}}#
                        </div>
                      </div>

                    </div>
                  </ng-template>
                </ejs-dialog>
          </div>
      </form>
      <button type="button" class="btn btn-outline-dark float-right" style="background: #3e4b5b;
      color: #ffffff;" (click)="SaveTemplate();modal.close('Save click')">Save</button>
  </div>
</ng-template> -->
<!--End Templates Modal -->

<!-- Deal Parametars modal -->
<!-- <div class="modal fade bd-example-modal-lgParam" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel"
    aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content-param">
            <div class="card-header d-block d-md-flex">
                <h5 class="mb-0">Fields</h5>
            </div>
            <div *ngIf="Deal && Deal.customFields && Deal.Fields" class="d-md-flex row m-0 quick-action-btns"
                role="group" aria-label="Quick action buttons" style="padding-left:50px;">
                <div class=" col-sm-6 col-md-4 p-2  btn-wrapper" *ngFor="let Field of Deal.Fields">
                    <div class="fieldInputs">
                        <i class="fas fa-stream"></i> {{GetFieldLabel(Field.id)}}
                    </div>
                    <br>
                    <input class="field-input mt-3" name="inputName" type="text" placeholder="Enter text here"
                        [(ngModel)]="Field.fieldValue">
                </div>
            </div>

            <div class="con">
                <div class="vertical-center">
                    <button type="submit" class="btn float-right " style="background: #3e4b5b;
                    color: #ffffff;"(click)="SaveCustomFields()">
                        Save</button>
                </div>
            </div>

        </div>
    </div>
</div> -->
<!-- End Deal Parametars modal -->

<!--  MacroDeal Parametars modal -->
<div class="modal fade bd-example-modal-lgParam1" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel"
    aria-hidden="true" >
    <div class="modal-dialog modal-lg">
        <div class="modal-content-paramMacroDeal" style="overflow: hidden;">
            <div class=" d-block d-md-flex" style="background-color: #1572e8!important; color: #fff; padding:10px ; display:flex; justify-content: center; ">
                <h5 class="mb-0" style=" font-size: 25px; letter-spacing: 2px;font-weight: 600;">Macro Deal Parameters</h5>
            </div>
      <div class="row" style="padding:10px">
        <div class="col-md-6" style="    border-right: 1px solid #ddd;" >
          <form #macroDealParam="ngForm" class="mx-5 mt-2" (ngSubmit)="SaveParam(macroDealParam)">
            <div *ngIf="Deal">
            <div class="form-group mt-2 ">
                <label for="title" class="ParamLabel">Title</label>
                <input class="form-control paramMacro" type="text" name="title" id="title" placeholder="Title" [(ngModel)]="Deal.macroDeal.title">
            </div>
            <div class="form-group mt-2">
              <label for="description" class="ParamLabel" >Description</label>


              <textarea class="form-control descriptionMacro"  type="text" name="description" rows="10"
              id="description" placeholder="Description"  [(ngModel)]="Deal.macroDeal.description"></textarea>
                  </div>


                <div style="display: flex;justify-content: space-between;margin-top: 25px;">
                  <div class="form-group col" style="padding-left:0">
                    <label for="city" class="ParamLabel" >City</label>
                    <input class="form-control paramMacro "  style="width: 150px;" type="text" name="city" id="city"
                     placeholder="City"  [(ngModel)]="Deal.macroDeal.city">
                  </div>

                  <div class="form-group  colmt-3 ml-2 " class="ParamLabel" style="padding-right:0" >
                    <label for="numberofUnits" style="margin-left: 10px;">State</label>
                    <input class="form-control paramMacro" type="text" name="numberofUnits" id="numberofUnits" style="width: 150px; margin-left: 9px;"
                    placeholder="Number of Units"  [(ngModel)]="Deal.macroDeal.state">
                  </div>
                </div>


            <div class="form-group mt-2 mb-2" class="ParamLabel">
              <label for="address">Address</label>
              <input class="form-control paramMacro " type="text" name="address" id="address" placeholder="Address"  [(ngModel)]="Deal.macroDeal.address">
            </div>

            <div *ngIf="Deal" style="display: flex;justify-content: space-between;margin-top: 25px;">
              <div class="form-group  col" class="ParamLabel" style="padding-left:0">
                <label for="squareFootage">Square Footage</label>
                <input class="form-control paramMacro " type="text" name="squareFootage" id="squareFootage" style="width: 150px;"
                placeholder="Square Footage"  [(ngModel)]="Deal.macroDeal.squareFootage">
              </div>
              <div class="form-group  colmt-3 ml-2 " class="ParamLabel" style="padding-right:0" >
                <label for="numberofUnits" style="margin-left: 10px;">Number of Units</label>
                <input class="form-control paramMacro" type="text" name="numberofUnits" id="numberofUnits" style="width: 150px; margin-left: 9px;"
                placeholder="Number of Units"  [(ngModel)]="Deal.macroDeal.numberofUnits">
              </div>

          </div>
            <div style="display: flex;justify-content: center; margin-top: 22px;">
            <button type="submit" class="btn btn-success mt-2 mb-2" style="background-color: #31ce36;
            border-color: #31ce36;
            padding: 13px 60px;
            letter-spacing: 1px;
            font-size: 16px;
            font-weight: 500;">Save</button>
          </div>
            </div>
          </form>
        </div>
        <div class="col-md-6">
          <table class="table table-bordered mt-2" *ngIf="Deal.macroDealParameters?.length>0">
            <thead>
              <tr>
                <th style="color: #353b48;"> Name </th>
                <th style="color: #353b48;"> Value </th>
              </tr>
            </thead>
            <tbody *ngIf="Deal">
              <tr *ngFor="let item of Deal.macroDealParameters">
                <td> {{item.parameterName}} </td>
                <td> {{item.paramaterValue}}  </td>
              </tr>
           </tbody>
          </table>
          <form #textareaForm="ngForm" class="mx-2 mt-2 " (ngSubmit)="SaveParamTextArea(textareaForm)" >
          <div class="form-group mt-3" class="ParamLabel"  style=" margin-top: 10px;">
            <label for="macroDealParam">Macro Deal Parameters</label>
            <textarea class="form-control " rows="4" style="border-color: #bbbbbb;
            border-radius: 5px;" name="macroDealParam"
            id="macroDealParam" placeholder="Macro Deal Parameters"  ngModel></textarea>
          </div>
          <div style="display: flex;justify-content: center; margin-top: 22px;">
            <button type="submit" class="btn btn-success  mt-2 mb-2"  style="    background-color: #31ce36;
            border-color: #31ce36;padding: 13px 60px;letter-spacing: 1px;font-size: 16px;font-weight: 500;">Save</button>
            </div>
          </form>
        </div>
      </div>

        </div>
    </div>
</div>
<!-- End Deal Parametars modal -->

<!-- Create scenario modal -->
<ng-template #CreateScenario let-modal >
  <div class="modal-content-createScenario">
    <div class="modal-body-createScenario">
      <div class=" d-block d-md-flex" style="background-color: #1572e8!important; color: #fff; padding:10px ; display:flex; justify-content: center; ">
        <h5 class="mb-0" style=" font-size: 25px; letter-spacing: 2px;font-weight: 600;">Create Scenario</h5>
    </div>

    <div style="margin:20px">
    <input placeholder="Scenario title"
         type="text" id="scenario" class="form-control" style="border-color: #bbbbbb;border-radius: 2px;" [(ngModel)]="General.NewScenarioTitle">
        </div>
        <div style="display: flex; justify-content: center; margin-block: 19px;">
        <button type="button" class="btn btn-outline-dark float-right"
        (click)="SaveScenario();modal.close('Save click')"  style="background-color:#31ce36;border-color: #31ce36; color:#fff ;padding: 13px 60px;" >Save</button>
      </div>
    </div>
  </div>
</ng-template>
<!-- End Create scenario modal -->

<!--  Start Files modal -->
<ng-template #Files let-modal>
  <div class="modal-body-createScenario">
    <div class=" d-block d-md-flex" style="background-color: #284b63!important; color: #fff; padding:10px ; display:flex; justify-content: center; ">
      <h5 class="mb-0" style=" font-size: 25px; letter-spacing: 2px;font-weight: 600;">Files</h5>
  </div>
  </div>
  <div  style="padding: 18px;" >
    <div *ngFor="let item of getGroupLevelFiles() ;let i = index ">
      <tr>
        <td>
          {{i+1}}- {{item.name}}  <span style="color: #1e272e; font-weight: 600;"> ({{getCategory(item.categoryId)}}) </span>
        </td>
      </tr>
    </div>
    <div class="float-right">
      <button type="button" class="btn delete-close mr-2"(click)="modal.close('Save click')">Close</button>
    </div>
  </div>
</ng-template>
<!-- End Files modal -->

<!--  Start Parametes for group modal -->
<ng-template #Parameters let-modal>
  <div class="modal-body-createScenario">
    <div class=" d-block d-md-flex" style="background-color: #284b63!important; color: #fff; padding:10px ; display:flex; justify-content: center; ">
      <h5 class="mb-0" style=" font-size: 25px; letter-spacing: 2px;font-weight: 600;">Parameters</h5>
  </div>
  </div>
  <div  style="padding: 18px;" >
      <table class="table table-bordered mt-2" *ngIf="General.modalObject?.groupParameters?.length>0">
        <thead>
          <tr>
            <th style="color: #353b48;"> Name </th>
            <th style="color: #353b48;"> Value </th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let item of General.modalObject.groupParameters">
            <td> {{item.parameterName}} </td>
            <td> {{item.paramaterValue}}  </td>
          </tr>
       </tbody>
      </table>
      <form #textareaFormForGroup="ngForm" class="mt-2 " (ngSubmit)="SaveParamForGroup(textareaFormForGroup)" >
      <div class="form-group mt-3" class="ParamLabel"  style=" margin-top: 10px;">
        <label for="macroDealParam">Group Parameters</label>
        <textarea class="form-control " rows="4" style="width: 455px;" name="groupParam"
        id="groupParam" placeholder="Macro Deal Parameters"  ngModel></textarea>
        </div>
        <div class="float-right">
          <button type="submit" class="btn btn-success mt-2 mr-2 ">Save</button>
        </div>
      </form>
    <!-- <div class="float-right">
      <button type="button" class="btn btn-outline-dark mr-2"(click)="modal.close('Save click')">Close</button>
    </div> -->
  </div>
</ng-template>
<!-- End Parametes for group modal -->

<!-- Start Move Stage -->
<ng-template #MoveStage let-modal >
  <div class="modal-body-moveStage">
    <p><b>Choose Stage</b></p>
      <ng-container *ngFor="let stage of General.modalObject.stages">
        <div (click)="MoveToStage(stage.id);modal.close('Close click')"
          style="cursor: pointer; padding: 6px; font-size: 20px;"> - {{stage.title}} {{stage.id}}</div>
      </ng-container>
  </div>
</ng-template>
<!-- End Move Stage -->

<!-- Start Assign  -->
<ng-template #Assign let-modal >
  <div class="modal-body-moveAssign">
    <p style="background-color: #ff9f43; padding: 10px;"><b>Assign To Microdeal </b></p>
    <div class="input-group mb-3" style="width: 50%;margin-top:5px;margin-left: 11px;">
      <span style="margin-top: 10px; margin-right: 7px;font-size: 15px;font-weight: bold;">- Enter Message Id:</span>
      <input type="text" class="form-control" placeholder="Message Id" style="border-radius: 5px;" aria-label="Username"
          aria-describedby="basic-addon1" [(ngModel)]="General.messageid">
      <button type="button" class="btn btn-success ml-2" (click)="GetMessageId()">Find</button>
   </div>
   <div class="content inbox container-fluid" *ngIf="General.Mail">
    <div class="row clearfix">
        <div class="col-md-12 col-lg-12 col-xl-12">
            <ul class="mail_list list-group list-unstyled">
                <li class="list-group-item unread" style="border-left: 0;">
                    <div class="media" style="cursor: pointer;">
                        <div class="media-body">
                            <div class="media-heading" (click)="toggleAssign=!toggleAssign">
                                <span *ngIf="General.Mail?.direction == 1" class="mr-2"
                                    style="background-color: #2ecc71; color: #fff; padding: 2px 4px; border-radius: 14px;">
                                    <i class="fas fa-envelope-square"></i>
                                </span>
                                <span *ngIf="General.Mail?.direction == -1" class="mr-2"
                                    style="background-color: #b2bec3; color: #fff; padding: 2px 4px; border-radius: 14px;">
                                    <i class="fas fa-chevron-right"></i>
                                </span>
                                <span *ngIf="General.Mail?.direction == 2" class="mr-2"
                                    style="background-color: #b2bec3; color: #fff; padding: 2px 4px; border-radius: 14px;">
                                    <i class="fas fa-angle-double-right"></i>
                                </span>
                                <a class="m-r-10"> {{General.Mail?.fromAddress}}</a>
                                <small class="float-right text-muted"><time class="hidden-sm-down" datetime="2017">
                                        {{General.Mail?.date | date }}
                                        <br> {{General.Mail?.date | date:'shortTime'}}</time><i
                                        class="zmdi zmdi-attachment-alt"></i>
                                </small>
                                <p class="msg">{{General.Mail?.subject}}</p>
                            </div>
                        </div>
                    </div>
                </li>
            </ul>
            <div *ngIf="toggleAssign" class=" email-body" style="background-color: #ecf0f1;">
                <div [innerHTML]="General.Mail?.body" class="mailBody container"></div>
            </div>
        </div>
    </div>
    </div>
    <button *ngIf="General.Mail" type="button" class="btn btn-success mr-2 float-right" (click)="AssignMailToMicroDeal()">Assign</button>
  </div>
</ng-template>
<!-- End Assign -->

<!-- Create Group Modal -->
<ng-template #CreateGroup let-modal>
  <div class="modal-body-createGroup">
    <p><b>Create Group For Scenario {{General.modalObject.title}}</b></p>
    <input type="text" class="form-control mb-3 " [(ngModel)]="General.modalObject.NewGroupTitle">
    <div class="float-right">
      <button type="button" class="btn btn-outline-dark " (click)="modal.close('Close click');">Close</button>
        <button type="button" class="btn btn-dark ml-2" (click)="SaveGroup();modal.close('Save click');">Save</button>
    </div>
  </div>
</ng-template>
<!--End Create Group Modal -->

<!-- Create Member -->
<ng-template #CreateMember let-modal >
  <div class="modal-body-createScenario">
    <div class=" d-block d-md-flex" style="background-color: #284b63!important; color: #fff; padding:10px ; display:flex; justify-content: center; ">
      <h5 class="mb-0" style=" font-size: 25px; letter-spacing: 2px;font-weight: 600;">Create new member</h5>
  </div>
  </div>
  <div class="modal-body-createMember">

    <label for="name" class="mt-2">First name:</label> <input [(ngModel)]="General.CreateMember.firstname" type="text" id="name" class="form-control mb-3">
    <label for="name" class="mt-2">Last name:</label> <input [(ngModel)]="General.CreateMember.lastname" type="text" id="name" class="form-control mb-3">
    <label for="email">Email:</label> <input [(ngModel)]="General.CreateMember.email" type="text" id="email" class="form-control mb-3">
    <label for="phone">Phone</label> <input [(ngModel)]="General.CreateMember.phone" type="text" id="phone" class="form-control mb-3" >
    <p>Select Person Type</p>
    <div >
      <select name="slct" id="slct" (change)="selectOptionType($event.target)" style="    font-size: 14px;
      border-color: #c8c8ca;padding: 0.6rem 1rem;height: inherit!important;line-height: 1.5;color: #495057;background-color: #fff;border-radius: 0.25rem;">
        <option selected value="0">All Persons Types</option>
        <option  *ngFor="let option of General.personTypes" [value]="option.id">{{option.label}}</option>
      </select>
    </div>
    <p class="mt-2">Select Organization</p>
    <div class="mb-4">
      <select name="slct" id="slct" (change)="selectOrg($event.target)" style="    font-size: 14px;
      border-color: #c8c8ca;padding: 0.6rem 0.1rem;height: inherit!important;
      line-height: 1.5;color: #495057;background-color: #fff;border-radius: 0.25rem;">
        <option selected value="0">All Organizations</option>
        <option  *ngFor="let option of General.Organiztion" [value]="option.id">{{option.name}} </option>
      </select>
    </div>
      <div class="float-right">
        <button type="button" class="btn delete-close mr-2"(click)="modal.close('Save click')">Close</button>
        <button type="button" class="btn "(click)="CreateOneMember(General.modalObject);modal.close('Save click')" style="background-color:#38ce3c; color: #fff;">Add Member</button>
      </div>
  </div>
</ng-template>
<!-- End Create Member -->

<!--Inbox Modal -->
<!-- <ng-template #MicroDealInbox let-modal>
    <div class="modal-header" style="padding: 5px 10px;">
        <p class="ml-5"><b>{{General.modalObject.title}} Inbox</b></p>

    </div>
    <div class="modal-body" style="padding: 5px 10px;">
        <div class="content inbox container-fluid" *ngFor="let email of General.modalObject.inbox">
            <div class="row clearfix">
                <div class="col-md-12 col-lg-12 col-xl-12">
                    <ul class="mail_list list-group list-unstyled">
                        <li class="list-group-item unread">
                            <div class="media" style="cursor: pointer;">
                                <div class="media-body">
                                    <div class="media-heading" (click)="OpenMail(email)">
                                        <span *ngIf="email.direction == 1" class="mr-2" style="background-color: #2ecc71; color: #fff; padding: 2px 4px; border-radius: 14px;">
                                            <i class="fas fa-envelope-square"></i>
                                        </span>
                                        <span *ngIf="email.direction == -1" class="mr-2" style="background-color: #b2bec3; color: #fff; padding: 2px 4px; border-radius: 14px;">
                                        <i class="fas fa-chevron-right"></i>
                                        </span>
                                        <span *ngIf="email.direction == 2" class="mr-2" style="background-color: #b2bec3; color: #fff; padding: 2px 4px; border-radius: 14px;">
                                            <i class="fas fa-angle-double-right"></i>
                                        </span>

                                        <a class="m-r-10"> {{email.fromAddress}}</a>
                                        <span class=" ml-2 badge bg-green">Work</span>
                                        <small class="float-right text-muted"><time class="hidden-sm-down" datetime="2017"> {{email.date | date }}
                                        <br>
                                        {{email.date
                                        |
                                        date:'shortTime'
                                        }}</time><i
                                        class="zmdi zmdi-attachment-alt"></i>
                                        </small>
                                        <p
                                        class="msg">
                                        {{email.subject}}
                                        </p>
                                        </div>
                                        </div>

                                        </div>
                                        </li>

                                        </ul>

                                        <div *ngIf="email.togglebody" class=" email-body">

                                        <div [innerHTML]="email.body"  class="mailBody">

                                        </div>

                                        <button class="btn btn-info mt-3 replayMail ml-auto" (click)="ReplyMail(email)">
                                            <ng-container >{{email.toggleReply? 'Close' : 'Reply'}}</ng-container>
                                        </button>


                                        <div *ngIf="email.toggleReply">
                                            <div class="mail-container">
                                                <div class="modal-body-mail" style="padding:10px;">
                                                    <form>
                                                        <div class="form-group">
                                                            <label for="recipient-name" class="col-form-label">
                                                                <b>Email body / Template body:</b>
                                                            </label>

                                                            <div>
                                                                <ejs-richtexteditor #replyRTE [toolbarSettings]='tools' [(ngModel)]='email.replyBody' name="replyRTE"> </ejs-richtexteditor>
                                                                <ejs-dialog #Dialog id="rteDialog" [buttons]='dlgButtons' (overlayClick)="dialogOverlay()" [header]='header'
                                                                [visible]='false' [showCloseIcon]='true' (created)="dialogCreate()" [isModal]='true'>
                                                                        <ng-template #content>
                                                                        <div id="rteSpecial_char">
                                                                            <h3> <b> Contact Data</b></h3>
                                                                        <div>

                                                                        <div class="btn btn-primary m-1 "
                                                                        title="Firstname"
                                                                        (click)="insertPersonalization('#Person.contact.firstName#')">
                                                                        #Person.contact.firstName#
                                                                        </div>
                                                                        <div class="btn btn-primary m-1"
                                                                        title="Lastname"
                                                                        (click)="insertPersonalization('#Person.contact.lastName#')">
                                                                        #Person.contact.lastName#
                                                                        </div>
                                                                        <div class="btn btn-primary m-1"
                                                                        title="email"
                                                                        (click)="insertPersonalization('#Person.contact.email#')">
                                                                        #Person.contact.email#
                                                                        </div>
                                                                        <div class="btn btn-primary m-1"
                                                                        title="phone"
                                                                        (click)="insertPersonalization('#Person.contact.phone#')">
                                                                        #Person.contact.phone#
                                                                        </div>

                                                                        </div>
                                                                        <br>
                                                                        <br>
                                                                        <h3> <b> Deal
                                                                        Data
                                                                        </b>
                                                                        </h3>
                                                                        <div class="btn btn-danger m-1"
                                                                        title="title"
                                                                        (click)="insertPersonalization('#Deal.data.title#')">
                                                                        #Deal.data.title#
                                                                        </div>

                                                                        <div style="display: inline-block;"
                                                                        *ngFor="let field of Deal.customFields.dealCustomFieldMeta">
                                                                        <div class="btn btn-danger m-1"
                                                                        title="Parameter.{{field.fieldLabel}}"
                                                                        (click)="insertPersonalization('#Parameter.'+field.fieldLabel+'#')">
                                                                        #Parameter.{{field.fieldLabel}}#
                                                                        </div>
                                                                        </div>

                                                                        </div>
                                                                        </ng-template>
                                                                </ejs-dialog>
                                                            </div>
                                                        </div>
                                                    </form>
                                                    <div class="modal-footer">
                                                         <button type="button" class="btn btn-primary" (click)="SendReplyEmail(email)">Send Email</button>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>

                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-outline-dark"  (click)="modal.close('Save click');">Close</button>
                    </div>
</ng-template> -->
<!--End Inbox Modal -->

<!--Contact Info Modal -->
<ng-template #ContactInfo let-modal>
  <div class="modal-body-info">
    <p *ngIf="General.modalObject.Contact"><b>{{General.modalObject.Contact.firstName}} {{General.modalObject.Contact.lastName}}</b></p>
    <div class="card-info" *ngIf="General.modalObject.Contact">
      <h4 class="card-title-info" style=" font-weight: bold;">
          Contact information</h4>
      <ul>
          <li><b>Name :</b>
              {{General.modalObject.Contact.firstName}}
              {{General.modalObject.Contact.lastName}}
          </li>
          <li><b>Email :</b>
              {{General.modalObject.Contact.email}}
          </li>
          <li *ngIf="General.modalObject.Contact.organization"><b>Organization : </b>
            <ng-container *ngFor="let account of General.accounts">
              <div style="display: inline-block;" *ngIf="General.modalObject.Contact.organization == account.id">
                          {{account.name}}
              </div>
            </ng-container>
              </li>
              <li *ngIf="General.modalObject.Contact.phone"><b>Phone:</b>
              {{General.modalObject.Contact.phone}}</li>
      </ul>

    </div>
          <button type="button" class="btn btn-outline-dark float-right"
          (click)="modal.close('Save click');">Close</button>
  </div>
</ng-template>
<!--End Contact Info Modal -->

<!--Activity  Modal -->
<ng-template #ActivityInfoMailRead let-modal>
  <div class="modal-header" style="padding: 5px;">
      <p class="ml-5"><b>{{General.modalObject.title}} Actions</b></p>
  </div>
  <div class="card-body-dates">
    <h3 class="card-title" style=" color: #38ce3c; font-weight: bold; letter-spacing: 0.4px; ">Dates</h3>
    <ul>
        <li *ngFor="let activity of General.modalObject.MailRead">
            <b>Date :</b> {{activity.actionDate |date}} <b>Time :</b> {{activity.actionDate |  date:'shortTime'}}
        </li>
        <li *ngIf="General.modalObject.MailRead == 0" >
          <tr>
            <td  align="center">No Actions</td>
          </tr>
        </li>
    </ul>
    <button type="button" class="btn btn-outline-dark float-right"(click)="modal.close('Save click');">Close</button>
  </div>
</ng-template>
<!--End Activity  Modal -->
<!--Activity  Modal -->
<ng-template #ActivityInfo let-modal>
  <div class="modal-header" style="padding: 5px;">
      <p class="ml-5"><b>{{General.modalObject.title}} Actions</b></p>
  </div>
  <div class="card-body-dates">
    <h3 class="card-title" style=" color: #38ce3c; font-weight: bold; letter-spacing: 0.4px; ">Dates</h3>
    <ul>
        <li *ngFor="let activity of General.modalObject.LandingPageLoad">
            <b>Date :</b> {{activity.actionDate |date}} <b>Time :</b> {{activity.actionDate |  date:'shortTime'}}
        </li>
        <li *ngIf="General.modalObject.LandingPageLoad == 0" >
          <tr>
            <td  align="center">No Actions</td>
          </tr>
        </li>
    </ul>
    <button type="button" class="btn btn-outline-dark float-right"(click)="modal.close('Save click');">Close</button>
  </div>
</ng-template>
<!--End Activity  Modal -->

<!--Activity  Modal -->
<ng-template #ActivityInfoPreviewFile let-modal>
  <div class="modal-header" style="padding: 5px;">
      <p class="ml-5"><b>{{General.modalObject.title}} Actions</b></p>
  </div>
  <div class="card-body-dates">
    <h3 class="card-title" style=" color: #38ce3c; font-weight: bold; letter-spacing: 0.4px; ">Dates</h3>
    <ul>
        <li *ngFor="let activity of General.modalObject.PreviewFile">
            <b>Date :</b> {{activity.actionDate |date}} <b>Time :</b> {{activity.actionDate |  date:'shortTime'}}
        </li>
        <li *ngIf="General.modalObject.PreviewFile == 0" >
          <tr>
            <td  align="center">No Actions</td>
          </tr>
        </li>
    </ul>
    <button type="button" class="btn btn-outline-dark float-right"(click)="modal.close('Save click');">Close</button>
  </div>
</ng-template>
<!--End Activity  Modal -->
<!--Activity  Modal -->
<ng-template #ActivityInfoPreviewFileDownlaodFile let-modal>
  <div class="modal-header" style="padding: 5px;">
      <p class="ml-5"><b>{{General.modalObject.title}} Actions</b></p>
  </div>
  <div class="card-body-dates">
    <h3 class="card-title" style=" color: #38ce3c; font-weight: bold; letter-spacing: 0.4px; ">Dates</h3>
    <ul>
        <li *ngFor="let activity of General.modalObject.DownlaodFile">
            <b>Date :</b> {{activity.actionDate |date}} <b>Time :</b> {{activity.actionDate |  date:'shortTime'}}
        </li>
        <li *ngIf="General.modalObject.DownlaodFile == 0" >
          <tr>
            <td  align="center">No Actions</td>
          </tr>
        </li>
    </ul>
    <button type="button" class="btn btn-outline-dark float-right"(click)="modal.close('Save click');">Close</button>
  </div>
</ng-template>
<!--End Activity  Modal -->

<!--Start Member Modal -->
<ng-template #Member let-modal>    <div class="modal-body-createScenario">
      <div class=" d-block d-md-flex" style="background-color: #284b63!important; color: #fff; padding:10px ; display:flex; justify-content: center; ">
        <h5 class="mb-0" style=" font-size: 25px; letter-spacing: 2px;font-weight: 600;">Add Organizations to {{General.modalObject?.title}}</h5>
        <!-- <button type="button" class="close" aria-label="Close" (click)="modal.dismiss('Cross click')"> <span aria-hidden="true">&times;</span> </button> -->
    </div>
    </div>
    <div class="modal-body">
        <div *ngIf="General.accounts">
          <div style="display: flex; justify-content: space-between;">

              <aside>

                  <input [(ngModel)]="personSearchName"  type="search" class="search" placeholder="Search By Name" />

              </aside>

              <aside>

                  <input [(ngModel)]="termOrg" type="search" class="search" placeholder="Search By Organization" />

              </aside>

                <div  *ngIf="General.PersonField">
                  <select class="custom-select" name="slct" id="slct" (change)="selectOption($event.target)">
                    <option selected value="0">All</option>
                    <option *ngFor="let option of General.PersonField[0].options" [value]="option.id">
                      {{option.label}}</option>
                  </select>
                </div>

                <div>
                  <button style="padding: 8px ;
                  background-color: #6861ce !important;color: #ffff;border-color: #6861ce !important; border-radius: 5px;"
                  (click)="InitAdvancedFilters();openLg(types)" class="add-member-btn addMember ml-3">Advanced Filters</button>
                </div>

              </div>
              <div>
              <div style="    margin: 10px 3px;font-size: 16px;">
                <input (change)="checkAllOrgnizations($event)" type="checkbox" class="mr-2 person-name"> Show PipeDrive Organization Only
              </div>

              <!-- <div style="margin: 0 0 10px 15px;font-size: 16px; ">
                <span> {{filterMetadata?.count}} Organization displayed</span>
              </div> -->

            </div>
               <div style="overflow-y: auto; height: 550px;">
              <table class="table table-striped table-bordered action-table" style="border:2px solid;">
                <thead>
                  <tr>
                    <th class="person-head">Organization</th>
                    <th class="person-head">Organization Information</th>
                    <th class="person-head">Email & Phone</th>
                  </tr>
                </thead>
                <tbody>
                  <ng-container *ngFor="let organization of General.Organizations|pipedriveId:havePipeDriveId:filterMetadata
                   |searchOrg:termOrg|search:personSearchName|type:personTypeId
                   |advancedSearch:General.AdvancedFilters:ApplyAdvancedFilters:filterMetadata;" >

                  <ng-container>
                      <tr>
                        <td style="white-space: pre-line ;vertical-align: baseline;" >
                          <div style="display: flex;">
                          <input (change)="check($event)" type="checkbox" id="input{{organization.id}}"
                            name="personid" class="mr-2 person-name" value="{{organization.id}}">
                          <label for="input{{organization.id}}"><span style="font-weight: bolder; font-size: l;">
                            {{organization.name}}  </span></label>
                          <ng-container *ngIf="organization.pipedriveId !== 0" >
                            <i class="fab fa-product-hunt" style="margin-left: 15px; font-size: 25px;"></i>    </ng-container>
                        </div>
                           <br>
                        </td>
                        <td style="white-space: pre-line ;line-height: 20px;font-size: 15px;">
                          <span *ngIf="organization.minimumLoanSize"> <b> Minimum Loan Size: </b> ${{+ organization.minimumLoanSize |number}}</span> <br>
                          <span *ngIf="organization.maximumLoanSize"> <b>  Maximum Loan Size:</b> ${{+ organization.maximumLoanSize |number}}</span><br>
                          <span *ngIf="organization.maxLtv"> <b>  Max LTV:  </b>{{+organization.maxLtv * 100}}%</span><br>
                          <span *ngIf="organization.maxLtc"> <b>  Max LTC: </b> {{+organization.maxLtc * 100}}%</span><br>
                          <span *ngIf="organization.asStabilizedLtv ">  <b> As-stabilized LT:</b> {{+organization.asStabilizedLtv * 100}} %</span><br>
                          <span *ngIf="organization.minDscr">  <b>  Min DSCR: </b>{{organization.minDscr}}</span><br>
                          <span *ngIf="organization.targetStates"> <b>States: </b> {{organization.targetStates}}</span> <br>
                          <span *ngIf="organization.targetCounties"> <b>Counties</b> {{organization.targetCounties}}</span> <br>
                          <span *ngIf="organization.acquisition" style="color: #52b69a;"><b>- Acquisition</b> </span> <br>
                          <span *ngIf="organization.newDevelopment" style="color: #52b69a;"><b>- New Development</b> </span> <br>
                          <span *ngIf="organization.redevelopment" style="color: #52b69a;"><b>- Redevelopment</b> </span> <br>
                          <span *ngIf="organization.refinance" style="color: #52b69a;"> <b>- Refinance</b></span> <br>
                          <span class="org-notes" *ngIf="organization.notes"> {{organization.notes}}</span> <br>
                        </td>
                        <td style="white-space: pre-line;">
                          <ng-container>
                            <div *ngFor="let person of organization.persons">
                              <div>
                                <span style="font-size: 20px;"> {{person.fullname}} </span>
                                  <ng-container *ngIf="GetLinkedIn(person)">
                                    <ng-container >
                                      <a  *ngIf="person.Linkedin!=''" href="{{person.Linkedin}}" target="_blank"><i class="fab fa-linkedin" style="font-size: 20px;"></i></a>

                                      <i class="fas fa-envelope-square" data-toggle="tooltip"
                                        data-placement="top" title="{{person.email}}" style="font-size: 20px; color: #f6b93b; margin-left: 7px;"></i>
                                     <i class="fas fa-phone" *ngIf="person.cellPhone" data-toggle="tooltip" data-placement="top"
                                      title="{{person.cellPhone}}" style="margin-left: 7px; font-size: 20px;color: #1e90ff;"></i>
                                    </ng-container>
                                 </ng-container>

                                <span class="person-type ">{{GetPersonType(person)}} </span>

                                <br>

                                <ng-container *ngIf="GetJobTitle(person)">
                                  <ng-container *ngIf="person.JobTitle!=''">
                                    <div style="margin-top: 3px;">
                                   <span class="job-title" style="color: #1B9CFC;font-size: 20px;"> {{person.JobTitle}} </span>
                                  </div>
                                  </ng-container>
                                </ng-container>


                                  </div>


                                <div style="padding:3px;" *ngFor="let personFieldValue of person.personFieldValues">
                                  <!--Address-->
                                   <ng-container *ngIf="personFieldValue.fieldId==3">
                                      {{personFieldValue.fieldValue}}
                                   </ng-container>
                                   <!--Notes-->
                                     <ng-container *ngIf="personFieldValue.fieldId==4">
                                       <div style="margin: 10px 0; padding: 10px; color: #fff;background-color: #011627; border-radius: 5px; word-spacing: 3px;">
                                         {{personFieldValue.fieldValue}}
                                        </div>
                                     </ng-container>
                               </div>
                               <div *ngIf="organization.persons.length > 1">
                                <hr>
                              </div>
                              </div>

                          <!-- <tr *ngIf="person.ToggleAddMemberInbox == true " style="position:sticky; top:-1">
                            <td colspan="3"   >

                              <div class="content inbox container-fluid"   *ngFor="let email of person.inboxPerson" >
                                <div class="row clearfix">
                                    <div class="col-md-12 col-lg-12 col-xl-12">
                                        <ul class="mail_list list-group list-unstyled">
                                            <li class="list-group-item unread">
                                                <div class="media" style="cursor: pointer;">
                                                    <div class="media-body">
                                                        <div class="media-heading" (click)="OpenMail(null,email)">
                                                            <span *ngIf="email.direction == 1" class="mr-2" style="background-color: #2ecc71; color: #fff; padding: 2px 4px; border-radius: 14px;">
                                                                <i class="fas fa-envelope-square"></i>
                                                            </span>
                                                            <span *ngIf="email.direction == -1" class="mr-2" style="background-color: #b2bec3; color: #fff; padding: 2px 4px; border-radius: 14px;">
                                                            <i class="fas fa-chevron-right"></i>
                                                            </span>
                                                            <span *ngIf="email.direction == 2" class="mr-2" style="background-color: #b2bec3; color: #fff; padding: 2px 4px; border-radius: 14px;">
                                                                <i class="fas fa-angle-double-right"></i>
                                                            </span>

                                                            <a class="m-r-10"> {{email.fromAddress}}</a>
                                                            <span class=" ml-2 badge bg-green">Work</span>
                                                            <small class="float-right text-muted"><time class="hidden-sm-down" datetime="2017"> {{email.date | date }}
                                                            <br>
                                                            {{email.date
                                                            |
                                                            date:'shortTime'
                                                            }}</time><i
                                                            class="zmdi zmdi-attachment-alt"></i>
                                                            </small>
                                                            <p class="msg">  {{email.subject}}</p>
                                                          </div>
                                                            </div>

                                                            </div>
                                                            </li>

                                                            </ul>

                                                            <div *ngIf="email.togglebody" class=" email-body">

                                                            <div [innerHTML]="email.body"  class="mailBody container">

                                                            </div>

                                                            <button class="btn btn-info mt-3 replayMail ml-auto" (click)="ReplyMail(email)">
                                                                <ng-container >{{email.toggleReply? 'Close' : 'Reply'}}</ng-container>
                                                            </button>


                                                            <div *ngIf="email.toggleReply">
                                                                <div class="mail-container container">
                                                                    <div class="modal-body-mail" style="padding:26px;">
                                                                        <form>
                                                                            <div class="form-group">
                                                                                <label for="recipient-name" class="col-form-label">
                                                                                    <b>Email body / Template body:</b>
                                                                                </label>

                                                                                <div>
                                                                        <ejs-richtexteditor #templateRTE [toolbarSettings]='tools'
                                                                        [innerHTML]='email.replyBody' name="replyRTE"> </ejs-richtexteditor>

                                                                        <ejs-dialog #templateDialog id="rteDialog" [buttons]='dlgButtons' (overlayClick)="dialogOverlay()" [header]='header'
                                                                        [visible]='false' [showCloseIcon]='true' (created)="dialogCreate()" [isModal]='true'>
                                                                        <ng-template #content>
                                                                        <div id="rteSpecial_char">
                                                                          <h3> <b> Contact Data</b></h3>
                                                                        <div>

                                                                        <div class="btn btn-primary m-1 "title="Firstname"
                                                                        (click)="insertPersonalization('#Person.contact.firstName#')">
                                                                        #Person.contact.firstName#</div>
                                                                        <div class="btn btn-primary m-1" title="Lastname"
                                                                        (click)="insertPersonalization('#Person.contact.lastName#')">
                                                                        #Person.contact.lastName# </div>
                                                                        <div class="btn btn-primary m-1" title="email"  (click)="insertPersonalization('#Person.contact.email#')">
                                                                        #Person.contact.email#</div>
                                                                        <div class="btn btn-primary m-1"title="phone"
                                                                        (click)="insertPersonalization('#Person.contact.phone#')">
                                                                        #Person.contact.phone#</div>
                                                                        </div>
                                                                        <br> <br>
                                                                        <h3> <b> Deal Data  </b></h3>
                                                                        <div class="btn btn-danger m-1" title="title"(click)="insertPersonalization('#Deal.data.title#')">
                                                                        #Deal.data.title# </div>

                                                                        <div style="display: inline-block;" *ngFor="let field of Deal.customFields.dealCustomFieldMeta">
                                                                        <div class="btn btn-danger m-1"title="Parameter.{{field.fieldLabel}}"
                                                                        (click)="insertPersonalization('#Parameter.'+field.fieldLabel+'#')">
                                                                        #Parameter.{{field.fieldLabel}}# </div>
                                                                        </div>

                                                                                            </div>
                                                                                            </ng-template>
                                                                                    </ejs-dialog>
                                                                                </div>

                                                                            </div>
                                                                        </form>
                                                                        <div></div>

                                                                    </div>
                                                                </div>

                                                            </div>


                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                          </td>
                          </tr>
                         -->

                          </ng-container>
                        </td>
                    </tr>
                    </ng-container>

                </ng-container>

                </tbody>
              </table>
            </div>

        </div>

    </div>
    <div class="modal-footer">
      <div class="float-right">
        <button type="button" class="btn btn-outline-dark"
        (click)="modal.close('Save click');">Close</button>
        <button type="button" class="btn btn-dark ml-2" style="background-color: #31ce36;" (click)="Send();modal.close('Save click');">Add Members</button>
    </div>
    </div>
</ng-template>
<!--End Member Modal -->
<ng-template #types let-modal>
  <div  style=" height: auto;padding: 22px;">
    <div class="col-lg-12 grid-margin stretch-card">
        <div class="card-body" style="padding: 0;">
          <table class="table table-bordered">
            <tbody >
              <tr>
                <td style="background-color: #4bcffa;"><p><b> Group 1 </b></p></td>
                <td>
              <div style="display: flex; justify-content: space-between;">
                <p > <input  type="checkbox" [(ngModel)]="General.AdvancedFilters.Apartments"/> Apartments</p>
                <p > <input  type="checkbox" [(ngModel)]="General.AdvancedFilters.Condos" /> Condos</p>
                <p > <input  type="checkbox" [(ngModel)]="General.AdvancedFilters.SeniorHousi"/> Senior Housi</p>
                <p > <input  type="checkbox" [(ngModel)]="General.AdvancedFilters.StudentHous"/> Student Hous</p>
                <p > <input  type="checkbox" [(ngModel)]="General.AdvancedFilters.AssistedLivi"/> Assisted Livi</p>
                <p > <input  type="checkbox" [(ngModel)]="General.AdvancedFilters.SFRPortfolio"/> SFR Portfolio</p>
                <p > <input  type="checkbox" [(ngModel)]="General.AdvancedFilters.MobileHome"/> Mobile Home</p>
                <p > <input  type="checkbox" [(ngModel)]="General.AdvancedFilters.Coliving"/> Co-living</p>  <br>
                <p > <input  type="checkbox" [(ngModel)]="General.AdvancedFilters.Office"/> Office</p>
                <p > <input  type="checkbox" [(ngModel)]="General.AdvancedFilters.MedicalOffice"/> Medical Office</p>
                <p > <input  type="checkbox" [(ngModel)]="General.AdvancedFilters.Manufacturi"/> Manufacturi </p>
               </div>
              <div style="display: flex; justify-content: space-between;">
                <p> <input  type="checkbox" [(ngModel)]="General.AdvancedFilters.Retail"/> Retail </p>
                <p> <input  type="checkbox" [(ngModel)]="General.AdvancedFilters.LtIndustrial"/> Lt Industrial </p>
                <p> <input  type="checkbox" [(ngModel)]="General.AdvancedFilters.Cannabis"/> Cannabis </p> <br>
                <p> <input  type="checkbox" [(ngModel)]="General.AdvancedFilters.Hotel"/> Hotel </p>
                <p> <input  type="checkbox" [(ngModel)]="General.AdvancedFilters.Land"/> Land </p>
                <p> <input  type="checkbox" [(ngModel)]="General.AdvancedFilters.Selfstorage"/> Self-storage </p>
                <p> <input  type="checkbox" [(ngModel)]="General.AdvancedFilters.Religious"/> Religious </p>
                <p> <input  type="checkbox" [(ngModel)]="General.AdvancedFilters.Hospital"/> Hospital </p>
                <p> <input  type="checkbox" [(ngModel)]="General.AdvancedFilters.Other"/> Other </p>
                <p> <input  type="checkbox" [(ngModel)]="General.AdvancedFilters.Leasedfee"/> LEASED FEE </p>
              </div>
              </td>
              </tr>
              <tr>
                <td style="background-color: #706fd3;"><p><b> Group 2 </b></p></td>
                <td>
                  <div style="display: flex; justify-content: space-between;">
                  <p > <input  type="checkbox" [(ngModel)]="General.AdvancedFilters.Senior"/> Senior</p>
                  <p class="ml-3"> <input  type="checkbox" [(ngModel)]="General.AdvancedFilters.Mezzanine"/> Mezzanine	</p>
                  <p class="ml-3"> <input  type="checkbox" [(ngModel)]="General.AdvancedFilters.Preferred"/> Preferred</p>
                  <p class="ml-3"> <input  type="checkbox" [(ngModel)]="General.AdvancedFilters.PreferredEquity"/> Preferred Equity</p>
                  <p class="ml-3"> <input  type="checkbox" [(ngModel)]="General.AdvancedFilters.Pace"/> PACE</p>
                  <p class="ml-3"> <input  type="checkbox" [(ngModel)]="General.AdvancedFilters.JVEquity"/> JV Equity</p>
                </div>
                 </td>
              </tr>
              <tr>
                <td style="background-color: #2ed573;"><p><b> Group 4 </b></p></td>
                <td>
                  <div style="display: flex; justify-content: space-between;">
                  <p > <input  type="checkbox" [(ngModel)]="General.AdvancedFilters.Acquisition"/> Acquisition</p>
                  <p class="ml-3"> <input  type="checkbox" [(ngModel)]="General.AdvancedFilters.NewDevelopment"/> 	New Development		</p>
                  <p class="ml-3"> <input  type="checkbox" [(ngModel)]="General.AdvancedFilters.Redevelopment"> Redevelopment	</p>
                  <p class="ml-3"> <input  type="checkbox" [(ngModel)]="General.AdvancedFilters.Refinance"/> Refinance</p>

                </div>
                 </td>
              </tr>
                <tr>
                  <td style="background-color: #e74c3c;"><p><b> States </b></p> </td>
                  <td>
                    <div style="display: flex; justify-content: space-between;">


                      <div  *ngIf="General.states">
                        <select name="slct" id="slct" (change)="GetState($event)">
                          <option  [value]="0">All</option>
                          <option *ngFor="let option of General.states" [value]="option.stateCode">
                            {{option.stateName}}</option>
                        </select>
                      </div>

                      <!-- <ng-multiselect-dropdown style="width: 200px;"
                      [placeholder]="'custom placeholder'"
                      [settings]="dropdownSettings"
                      [data]="dropdownList"
                      [(ngModel)]="selectedItems"

                      (onSelect)="onItemSelect($event)"
                      (onSelectAll)="onSelectAll($event)" >
                    </ng-multiselect-dropdown> -->
                    </div>

                  </td>





            </tr>

              <!-- <tr>
                <td style="background-color: #fed330;" ><p><b> Group 3 </b></p></td>
                <td>
                   <div style="display: flex; justify-content: space-between;">
                    <p> Minimum Loan Size <br> <input type="text"  [(ngModel)]="General.AdvancedFilters.MinimumLoanSize"/></p>
                    <p> Maximum Loan Size <br> <input type="text"  [(ngModel)]="General.AdvancedFilters.MaximumLoanSize" /></p>
                    <p> Max LTV <br>           <input type="text"  [(ngModel)]="General.AdvancedFilters.MaxLTV" /> </p>
                    <p> Max LTC <br>           <input type="text"  [(ngModel)]="General.AdvancedFilters.MaxLTC" /> </p>
                    <p> As-stabilized LT <br>  <input type="text"  [(ngModel)]="General.AdvancedFilters.AsastabilizedLT" /></p>
                    <p> Min DSCR<br>           <input type="text"  [(ngModel)]="General.AdvancedFilters.MinDSCR" /> </p>
                   </div>
                </td>
              </tr>
              <tr>
                <td style="background-color: #ff5252;" ><p> <b> Group 4 </b></p></td>
                <td>
                  <div style="display: flex;">
                    <p>Target States <br>               <input type="text" [(ngModel)]="General.AdvancedFilters.TargetStates"  /></p>
                    <p class="ml-3">Sponsor States <br> <input type="text" [(ngModel)]="General.AdvancedFilters.SponsorStates"  />	</p>
                  </div>
                </td>
              </tr>

              <tr>
                <td  style="background-color: #0652DD;" > <p> <b> Group 5 </b></p> </td>
                <td>
                  <div style="display: flex;">
                   <p>Recourse <br> <input type="text" [(ngModel)]="General.AdvancedFilters.Recourse" /></p>
                </div>
              </td>
              </tr>
              <tr>
                <td style="background-color: #0652DD;"> <p> <b> Group 6 </b></p> </td>
                <td>
                  <div style="display: flex;">
                    <p>	Loan Program Type  <br> <input type="text" [(ngModel)]="General.AdvancedFilters.LoanProgramType" /></p>
                  </div>
                </td>
              </tr> -->
            </tbody>
          </table>
        </div>

    </div>

    <div class="modal-footer">
      <div class="float-right">
        <button type="button" class="btn btn-outline-dark" (click)="modal.close('Save click');">Close</button>
        <button type="button" class="btn btn-dark ml-2"(click)="TriggerAdvancedFilters();modal.close('Save click');">Apply</button>
    </div>
    </div>
  </div>
</ng-template>

<!-- Start Delete Scenario Modal -->
<ng-template #DeleteScenarioModal let-modal>
  <div class="modal-body-DeleteScenario">
    <p *ngIf="General.modalObject.title">Are you sure you want to delete <b>{{General.modalObject.title}}</b> ?</p>
    <div style="margin-top: 28px;">
      <button type="button" class="btn btn-danger float-right ml-2"
       (click)="DeleteScenario(General.modalObject.id);modal.close('Save click')">Delete</button>
       <button type="button" class="btn btn-outline-dark float-right"
         (click)="modal.close('Save click');">Close</button>
   </div>
  </div>
</ng-template>
<!--  End Delete Scenario Modal -->

<!-- Start Delete Group Modal -->
<ng-template #DeleteGroupModal let-modal>
  <div class="modal-body-DeleteScenario">
    <p *ngIf="General.modalObject.title">Are you sure you want to delete <b>{{General.modalObject.title}}</b> ?</p>
    <div style="margin-top: 28px;">
      <button type="button" class="btn btn-danger float-right ml-2"
       (click)="DeleteGroup(General.modalObject.id , General.modalObject2 );modal.close('Save click')">Delete</button>
       <button type="button" class="btn delete-close float-right"
         (click)="modal.close('Save click');">Close</button>
   </div>
  </div>
</ng-template>
<!--  End Delete Group Modal -->

<!-- Start Delete MicroDeal Modal -->
<ng-template #DeleteMicroDealModal let-modal>
  <div class="modal-body-DeleteScenario">
    <p *ngIf="General.modalObject2.title">Are you sure you want to delete ?</p>
    <div style="margin-top: 28px;">
      <button type="button" class="btn btn-danger float-right ml-2"
       (click)="DeleteMicroDeal(General.modalObject2.id , General.modalObject );modal.close('Save click')">Delete</button>
       <button type="button" class="main-close float-right"
         (click)="modal.close('Save click');">Close</button>
   </div>
  </div>
</ng-template>
<!--  End Delete MicroDeal Modal -->




<!-- End Modals -->

